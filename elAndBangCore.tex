\section{\ELFULL}\label{coreEL}

In this section we introduce the syntax and semantics of \ELFULL{}
(hereafter \ELABR{}).  Then we establish key completeness of the the
proof rules and prove a the compactness theorem via a translation into
first-order logic. We focus on a small core of \ELABR{}, leaving
extensions to later section.

\subsection{Syntax}

\NI Syntactically, eremic logic is a multi-modal logic with one new
operator.

\begin{definition} Let $\Sigma$ be a non-empty set of \emph{actions}.
Actions are ranged over by $a, a', a_1, b, ...$, and $A$ ranges over
finite subsets of $\Sigma$. The \emph{formulae}, ranged over by $\phi,
\psi, \xi ...$, of \ELABR{} are given by the
following grammar.

\begin{GRAMMAR}
  \phi 
     &\quad ::= \quad & 
  \TRUE 
     \VERTICAL 
  \phi \AND \psi
     \VERTICAL 
  \MAY{a}{\phi}
     \VERTICAL 
  \fBang A 
\end{GRAMMAR}
\end{definition}

\NI  Before presenting models and the satisfaction relation, we sketch
the meaning of formulae informally. $\TRUE$ is truth and $\phi \AND
\psi$ is the conjunction of formulae $\phi$ and $\psi$. Clearly
$\MAY{a}{\phi}$ is the may-modality which asserts that the current
state may do action $a$ and in doing $a$ transitions into a now state
at which $\phi$ holds.  The key novelty of eremic logic is $!A$,
pronounced ``just $A$, or ``tantum $A$. The core intuition about $!A$
is that if a model validates $!A$ at the current state, then the only
modalities $\MAY{a}{}$ available at the corrent state are those with
$a \in A$. 

The set of actions must be non-empty to avoid that the logic is
trivial. The restriction to finite subsets of action substantially
simplifies the meta-theory of the logic.

We often abbreviate $\MAY{a}{\TRUE}$ to $\MAY{a}{}$. We define falsity
$\FALSE$ as $!\emptyset \AND \MAY{a}{}$ where $a$ is an arbitrary
action. Note that in the absence of conventional negation, we cannot
readily define disjunction, implication, or must-modalities by de
Morgan duality. We discuss later \martin{Where?} how some of the usual
propositional connectives can be (partially) recovered. \martin{What
  about must modalities?}

\begin{convention}
From now on we assume a fixed set $\Sigma$ of actions, except where
stated otherwise.
\end{convention}

\subsection{Semantics}

\NI The semantics of eremic logic is close to Hennessy-Milner logic
\cite{HennessyM:alglawfndac} and uses labelled transition systems, as
described in Section \ref{preliminaries}, but augmented with labels on
states.

\begin{definition}
An \emph{eremic transition system} is a triple $(S, \rightarrow,
\lambda)$, where $(S, \rightarrow)$ is a labelled transition system
over $\Sigma$, and $\lambda$ is a function from states to sets of
actions (not necessarily finite), subject to the following constraints:
\begin{itemize}

\item For all states $s \in S$ it is the case that $ \{a \fOr \exists
  t \; s \xrightarrow{a} t\} \subseteq \lambda(s)$. We call this
  condition \emph{admissibility}.

\item For all states $s \in S$, $\lambda (s)$ is either finite or
  $\Sigma$. We call this condition \emph{well-sizedness}.

\end{itemize}

\end{definition}

\NI The intended interpretation is that $\lambda(w)$ is the set of
allowed transition symbols emanating from $w$.  The $\lambda$ function
is the semantic counterpart of the $!$ operator.  The admissibility
restriction is in place because transitions $s \TRANS{a} t$ where $a
\notin \lambda(s)$ would be saying that an $a$ action is possible at
$s$ but at the same time prohibit $a$ actions at that state.
Well-sizedness is not a fundamental restriction but rather a
convenient trick. Essentially eremic transition systems have two kinds
of nodes:

\begin{itemize}

\item Nodes $s$ without restrictions on outgoing transitions. Those are
  labelled with $\lambda ( s) = \Sigma$.

\item Nodes $s$ with restriction on outgoing transitions. Those are
  labelled by a finite set $\lambda ( s)$ of actions.

\end{itemize}

\NI Defining $\lambda$ on all nodes and not just on those with
restrictions makes some definitions and proofs slightly easier.

As with outher modal logics, satisfaction of formulae is defined
relative to a state in the ambient eremic transition system, giving
rise to the following definition.

\begin{definition}
A \emph{eremic model}, ranged over by $\MMM, \MMM', ...$, is a pair $(\LLL,
s)$, where $\LLL$ is an eremic transition system $(S, \rightarrow,
\lambda)$, and $s$ is a state from $S$.
\end{definition}

\NI With eremic models at hand, we can finally formalise the
satisfaction relation for eremic formulae.

\begin{definition}
The \emph{satisfaction relation} $\MMM \models \phi$ is defined
inductively by the following clauses, where we assume that $\MMM =
(\LLL, s)$ and $\LLL = (S, \rightarrow, \lambda)$.

\[
\begin{array}{lclcl}
  \MMM & \models & \top   \\
  \MMM & \models & \phi \AND \psi &\ \mbox{ iff } \ & \MMM  \models \phi \mbox { and } \MMM \models \psi  \\
  \MMM & \models & \langle a \rangle \phi & \mbox{ iff } & \text{there is a } s \xrightarrow{a} t \mbox { such that } (\LLL, t) \models \phi  \\
  \MMM & \models & \fBang A &\mbox{ iff } & \lambda(s) \subseteq A
\end{array}
\]

\end{definition}

\NI The first three clauses are standard, and Figure
\ref{figure:elAndBang:models} gives examples of models for the formula
$\MAY{a}{\MAY{b}{\TRUE}}$.  The last clause enforces the intended
meaning of $!A$: the available modalities in the model are \emph{at
  least as constrainted} as required by $!A$. They may even be more
constrainted, if the inclusion $\lambda(s) \subseteq A$ is proper. We
note in the case where the set $\Sigma$ of actions is infinite,
allowing $\lambda(s)$ to return arbitrary inifinite sets in addition
to $\sigma$ does not make a difference because $A$ is finite by
construction, so $\lambda(s) \subseteq A$ can never hold when
$\lambda(s)$ is infinite. Figure \ref{figure:elAndBang:moreMdels}
presents examples of validating (and otherwise) the formula $!\{a, b,
c\}$.

\input{figure:elAndBang:models}
\input{figure:elAndBang:moreMdels}

\martin{We could Add more examples, maybe ones that we do something with later.}

\begin{definition}
Let $\Gamma$ be an arbitrary set of formulae. We say \emph{$\Gamma$
  semantically implies $\phi$}, written $\Gamma \models \phi$,
provided for all eremic models $\MMM$ if it is the case that $\MMM
\models \Gamma$ implies $\MMM \models \phi$. 
\end{definition}


\subsection{Inference Rules}

\input{figure:elAndBangRules}

\NI We now present the inference rules for \ELFULL{}. There are no
axioms.

\begin{definition} Judgements are of the following form.
\[
  \phi \judge \psi.
\]
Figure \ref{figure:elAndBangRules} presents all proof rules. 
\end{definition}

\NI Note that $\phi$ and $\psi$ are single formulae, not sequents.  By
using single formulae, we can avoid structural inference rules.  \ELABR{}
proof rules can be grouped in two parts: standard rules and rules
unique to \ELABR{}.  Standard rules are [\RULENAME{Identity}],
[\RULENAME{$\top$-Right}], [\RULENAME{$\bot$-Left}],
[\RULENAME{Transitivity}], [\RULENAME{$\AND$-Left 1}],
[\RULENAME{$\AND$-Left 2}] and [\RULENAME{$\AND$-Right}] hardly need
explanation as they are variants of familiar rules for propositional
logic, see e.g.~\cite{TroelstraAS:basprot,vanDalenD:logstr}.  We now
explain the rules that give EL's its distinctive properties: the
relations betwen $\langle \rangle$, $!$ and $\bot$.

The rule [\RULENAME{$\bot$-Right 1}] axiom captures the core
\emph{exclusion} property of !: for example if $A = \{male, female\}$
then $\MAY{orange}{\phi}$ is incompatible with $!A$. Thus $!A \AND
\MAY{orange}{\phi}$ must be false.

The rule [\RULENAME{$\bot$-Right 2}] expresses that falsity is 'global'
  and cannot be surpressed by prefixing. For example
  $\MAY{orange}{\bot}$ is false, simply because $\bot$ is already
  false.

Relatedly, the rule [\RULENAME{Transition Normal}] enables us to
prefix an inference with a may-modality. For example \martin{add good
  example here.}. Note that it is vital for soundness that $\phi$ in $\phi
\judge \psi$ is a single formula. If we used transitional sequents $\phi_1, ..., \phi_n \judge \psi$,
then the rule
\[
   \ONEPREMISERULE
   {
     \phi_1, ..., \phi_n \judge \psi
   }
   {
     \MAY{a}{\phi_1}, ..., \MAY{a}{\phi_n} \judge \MAY{a}{\psi}
   }
\]
is unsound. \martin{explain why, and why this is significant}. This
restriction is also in place in \cite{GaySJ:typcalosp} where a
Curry-Howard corrospondence between a fragment of linear logic
\cite{GirardJY:linlog,GirardJY:protyp} and a process calculus is
introduced. We discuss the relationship between EL and linear logic in
general, and linear logic's additive conjunction in Section
\ref{conclusion}.

Note that the logic has no axioms. One reason for a purely rule-based
presentation is the absence of implication in the present fragment of
EL. \martin{explain in more detail!}

We close this subsection with a key meta-theorem.

\begin{theorem}\label{theorem:elAndBang:soundComplete}
The rules in Figure \ref{figure:elAndBangRules} are sound and complete:
\begin{enumerate}

\item\label{theorem:elAndBang:sound} (Soundness) $\phi \judge \psi$ implies $\phi \models \psi$.

\item\label{theorem:elAndBang:complete} (Completeness) $\phi \models \psi$ implies $\phi \judge \psi$.

\end{enumerate}
\end{theorem}

\NI Soundness is immediate from the definitions. Proof of completeness is
deferred to Section \ref{completenessProof}. 

\begin{definition}
We write $\phi_1, ...,
\phi_n \judge \psi$ whenever $\BIGAND_{i}\phi_i \judge \psi$.  For
arbitrary sets $\Gamma$ of formulae, we write $\Gamma \judge \psi$
provided there are $\phi_1, ..., \phi_n \in \Gamma$ such that $\phi_1,
..., \phi_n \judge \psi$.
\end{definition}

\begin{corollary}
The rules in Figure \ref{figure:elAndBangRules} are sound and complete:
\begin{enumerate}

\item(Soundness) $\Gamma \judge \psi$ implies $\Gamma \models \psi$.

\item (Completeness) $\Gamma \models \psi$ implies $\Gamma \judge \psi$.\martin{I don't know how to prove it!}

\end{enumerate}
\end{corollary}

\begin{proof}
For soundness assume that $\MMM$ is a model with $\MMM \models
\Gamma$.  We know that $\Gamma \judge \psi$ means that we can find a
finite number of formulae $\phi_i \in \Gamma$ with $\AND_i \phi \judge
\psi$.  By soundness then also $\AND_i \phi \models \psi$, hence
clearly $\Gamma \models \psi$.

For completeness \martin{To do!}
\end{proof}

\subsection{\RULENAME{!-Left} and \RULENAME{!-Right}}

The rules [\RULENAME{!-Right 1}, \RULENAME{!-Right 2}] jointly express
how the subset relation $\subseteq$ on sets of symbols relates to
provability. Why  don't we need a corresponding rule \RULENAME{!-Left} for
strengthening $!$ on the left hand side?
\[
   \TWOPREMISERULENAMEDRIGHT
     {
       \phi \AND \, !A \judge \psi
     }
     {
       A' \subseteq A
     }
     {
       \phi \AND\, !A' \judge \psi
     }{!-Left}
\]
The reason is that [\RULENAME{!-Left}] can be derived as follows.
\begin{center}
  \AxiomC{$\phi \AND\, !A'  \judge  \phi \AND\, !A'$}
  \AxiomC{$A' \subseteq A$}
  \LeftLabel{\RULENAME{!-Right 1}}
  \BinaryInfC{$\phi \AND\, !A'  \judge  \phi \AND\, !A$}
  \AxiomC{$\phi \AND\, !A  \judge  \psi$}
  \LeftLabel{Transitivity: \quad}
  \BinaryInfC{$\phi \AND\, !A'  \judge  \psi$}
  \DisplayProof
\end{center}
\martin{inconsisten formating of rule names.}

\NI Readers familiar with object-oriented programming will recognise
[\RULENAME{!-Left}] as contra-variant subtyping and [\RULENAME{!-Right
    1}] as covariant subtyping. Honda \cite{HondaK:thetypftpc}
develops a full theory of subtyping based on similar ideas.  All three
rules embody the intuition that whenever $A \subseteq A'$ then
asserting that $!A'$ is as strong as, or a stronger statement than
$!A$. [\RULENAME{!-Left}] simply states that we can always strengthen
our premise, while [\RULENAME{!-right 1}] allows us to weaken the
premise.

\subsection{Example inferences}

We give some example inferences that illustrate how EL is used in
practice.  \martin{Add some example assertions here, for example some
  of those we use later.}
  
\subsection{Proof of completeness}\label{completenessProof}

\NI We now prove completeness of the rules in Figure
\ref{figure:elAndBangRules}.  The proof requires the development of
the following additional technology which is also useful in other
contexts.

\begin{itemize}

\item An ordering $\MODELLEQ$ on models, which enables us to speak of
  the simplest model satisfying a formula.

\item An algorithm which gives the simplest model for a formula.

\item An algorithm which gives the a formula characterising a model.

\end{itemize}

\NI We now develop these three in turn and then prove completeness.

\subsubsection{A partial ordering on models}

We shall develop a partial-ordering $\MODELLEQ$ on models by extending
the notion of simulation on labeled transition systems. We then give
an alternative characterisation of $\MODELLEQ$ in terms of
set-inclusion of the theories induced by models. Simulations on eremic
transition systems give rise only to a pre-order, and we use the
standard quotienting process to obtain the desired partial order.

\begin{definition}
Let $\LLL_i = (S_i, \rightarrow_i, \lambda_i)$ be eremic transition
systems for $i = 1, 2$.  A relation $\RRR \subseteq S_1 \times S_2$ is
a \emph{simulation from $\LLL_1$ to $\LLL_2$}, provided:
\begin{itemize} 

\item $\RRR$ is a simulation on the underlying transition systems. 

\item Whenever $(s, t) \in \RRR$ then also $\lambda_1(s) \supseteq
  \lambda_2(t)$.

\end{itemize}

\NI If $\MMM_i = (\LLL_i, s_i)$ are models, we say $\RRR$ is a
\emph{simulation from $\MMM_1$ to $\MMM_2$}, provided the following hold.

\begin{itemize}

\item $\RRR$ is a simulation from $\LLL_1$ to $\LLL_2$ as eremic transition systems.

\item  $(s_1, s_2) \in \RRR$. 

\end{itemize}

\end{definition}

\NI Note that the only difference form the usual definition of
simulation is the additional requirement on the node labelling
functions $\lambda_1$ and $\lambda_2$.

\begin{definition}
The largest simulation from $\MMM_1$ to $\MMM_2$ is denoted $\MMM_1
\SIM \MMM_2$.  It is easy to see that $\SIM$ is itself a
simulation from $\MMM_1$ to $\MMM_2$, and the union of all such
simulations.  If $\MMM_1 \SIM \MMM_2$ we say $\MMM_2$
\emph{simulates} $\MMM_1$.
\end{definition}

\begin{definition}
We say $\RRR$ is a \emph{bisimulation} if $\RRR$ is a simulation from
$\MMM_1$ to $\MMM_2$ and $\RRR^{-1}$ is a simulation from $\MMM_2$ to
$\MMM_1$. By $\BISIM$ we denote the largest bisimulation, and we say
that $\MMM_1$ and $\MMM_2$ are \emph{bisimilar} whenever $\MMM_1
\BISIM \MMM_2$.
\end{definition}

\begin{definition}
Let $\THEORY{\MMM}$ be the \emph{theory} of $\MMM$, i.e.~the formulae
made true by $\MMM$, i.e.~$\THEORY{\MMM} = \{\phi\ |\ \MMM \models
\phi \}$.
\end{definition}

\NI We give an alternative characterisation on $\SIM^{-1}$ in terms of
theories of models. In what follows, we will mostly be interested in
$\SIM^{-1}$, so we give it its own symbol.

\begin{definition}
Let $\MODELLEQ$  be short for $\SIM^{-1}$.
\end{definition}

\NI Figure \ref{figure:leq} gives some examples of models and how they
are related by $\MODELLEQ$.

\input{figure:leq}

\begin{theorem}\label{theorem:completeLattice}
$\MMM' \MODELLEQ \MMM$ if and only if
$\THEORY{\MMM} \subseteq  \THEORY{\MMM'}$.
\end{theorem}

\begin{proof}
Assume $\MMM' \MODELLEQ \MMM$ and $\MMM \models \phi$.  We must show
$\MMM' \models \phi$.  Let $\MMM = (\LLL, w)$ and $\MMM' = (\LLL',
w')$.  The proof proceeds by induction on $\phi$.  The cases for
$\top$ and $\land$ are trivial.  Assume $\phi = \MAY{a}\psi$ and
assume $(\LLL, w) \models \MAY{a}\psi$.  Then $w \xrightarrow{a} x$
and $(\LLL, x) \models \psi$.  As $\MMM'$ simulates $\MMM$, there is
an $x'$ such that $(x,x') \in R$ and $w' \xrightarrow{a} x'$.  By the
induction hypothesis, $(\LLL', x') \models \psi$.  Therefore, by the
semantic clause for $!$, $(\LLL', w') \models \MAY{a}\psi$.  Assume
now that $\phi = \; ! \; A$, for some finite $A \subseteq \Sigma$, and
that $(\LLL, w) \models \; ! \; A$.  By the semantic clause for $!$,
$\lambda(w) \subseteq A$.  Since $(\LLL', w') \MODELLEQ (\LLL, w)$, by
the definition of simulation of eremic transition systems, $\lambda(w)
\supseteq \lambda'(w')$.  Therefore, $\lambda'(w') \subseteq
\lambda(w) \subseteq A$.  Therefore, by the semantic clause for $!$,
$(\LLL', w') \models \; ! \; A$.

For the other direction, let $\MMM = (\LLL, w)$ and $\MMM' = (\LLL',
w')$.  Assume $\THEORY{\MMM} \subseteq \THEORY{\MMM'} $. We need to
show that $\MMM'$ simulates $\MMM$.  In other words, we need to
produce a relation $R \subseteq S \times S'$ where $S$ is the state
set of $\LLL$, $S'$ is the state set for $\LLL'$ and $(w,w') \in R$
and $R$ is a simulation from $(\LLL, w)$ to $ (\LLL', w')$.  Define $R
= \{(x,x') \; | \; \THEORY{ (\LLL, x)} \subseteq \THEORY{ (\LLL',
  x')}\}$.  Clearly, $(w,w') \in R$, as $\THEORY{(\LLL, w)} \subseteq
\THEORY{(\LLL', w')} $.  To show that $R$ is a simulation, assume $x
\xrightarrow{a} y$ in $\LLL$ and $(x,x') \in R$. 
We need to provide a
$y'$ such that $x' \xrightarrow{a} y'$ in $\LLL'$ and $(y,y') \in R$.  
Consider the formula $\MAY{a}\CHAR{(\LLL, y)}$. 
Now $x \models \MAY{a}\CHAR{(\LLL, y)}$, and since $(x,x') \in R$, $x' \models \MAY{a}\CHAR{(\LLL, y)}$.
By the semantic clause for $\MAY{a}$, if $x' \models \MAY{a}\CHAR{(\LLL, y)}$ then there is a $y'$ such that 
$y' \models \CHAR{(\LLL, y)}$.
We need to show $(y,y') \in R$, i.e. that $y \models \phi$ implies $y' \models \phi$ for all $\phi$.
Assume $y \models \phi$. 
Then by the definition of $\CHAR$, $\CHAR{(\LLL, y)} \models \phi$.
Since $y' \models \CHAR{(\LLL, y)}$, $y' \models \phi$. 
So $(y,y') \in R$, as required.

Finally,we need to show that whenever $(x,x') \in R$, then $\lambda(x)
\supseteq \lambda'(x')$.  Assume, first, that $\lambda(x)$ is finite.
Then $(\LLL, x) \models \; ! \; \lambda(x)$.  But as $(x,x') \in R$,
$\THEORY{(\LLL, x)} \subseteq \THEORY{(\LLL', x')} $, so $(\LLL', x')
\models \; ! \; \lambda(x)$.  But, by the semantic clause for $!$,
$(\LLL', x') \models \; ! \; \lambda(x)$ iff $\lambda'(x') \subseteq
\lambda(x)$.  Therefore $\lambda(x) \supseteq \lambda'(x')$.  If, on
the other hand, $\lambda(x)$ is infinite, then $\lambda(x) = \Sigma$
(because the only infinite node labelling that we allow is
$\Sigma$). Every node labelling is a subset of $\Sigma$, so here too,
$\lambda(x) = \Sigma \supseteq \lambda'(x')$.  
\end{proof}

Theorem \ref{theorem:completeLattice} illustrates from a
model-theoretic point of view how classical and eremic logic
differ. In classical logic the theory of each model is complete, and
$\THEORY{\CAL{M}} \subseteq \THEORY{\CAL{N}}$ already implies that
$\THEORY{\CAL{M}} = \THEORY{\CAL{N}}$, i.e.~$\CAL{M}$ and $\CAL{N}$
are elementarily equivalent. \ELFULL{}'s lack of negation changes
this drastically, and gives $\MODELLEQ$ the structure of a non-trivial
complete lattice as we shall demonstrate now.

It turns out that $\MODELLEQ $ on (equivalence classes of) models is
not just a partial order, but a complete lattice, except that a bottom
element is missing.

\begin{definition}
We extend the collection of models with a single \emph{bottom} element
$\bot$, where $\bot \models \phi$ for all $\phi$. 
We extend the relation $\MODELLEQ $  and stipulate that $\bot
\MODELLEQ \MMM$ for all models $\MMM$.
\end{definition}

\NI As already mentioned, the relation $\MODELLEQ$ is not a partial
order, only a pre-order. For example with
\begin{itemize}

\item $\MMM_1 = ( (\{w\}, \{\}, \{w \mapsto \Sigma\}), w)$ and
\item $\MMM_2 = ( (\{v\}, \{\}, \{v \mapsto \Sigma\}), v)$ 

\end{itemize}

\NI we have models where $\MMM_1 \MODELLEQ \MMM_2$ and $\MMM_2
\MODELLEQ \MMM_1$, but the two models are not equal. The difference
between the two models, the name of the unique state, is trival and
not relevant for the formulae they make true. Indeed $\THEORY{\MMM_1}
= \THEORY{\MMM_2}$.  As briefly mentioned in the mathematical
preliminaries (Section \ref{preliminaries}), we obtain a proper
partial-order we simply quotient the set of models:

\[
   \MMM \MODELEQ \MMM'
      \qquad\text{iff}\qquad
   \MMM \MODELLEQ \MMM' \ \text{and}\ \MMM' \MODELLEQ \MMM.
\]

\NI and the ordering the $\MODELEQ$-equivalence classes as follows:
\[
    [\MMM]_{\MODELEQ} \MODELLEQ [\MMM']_{\MODELEQ}
      \qquad\text{iff}\qquad
    \MMM \MODELLEQ \MMM'.
\]

\NI Since this process is independent for the chosen representatives,
we obtain a partial order. Greatest lower and least upper bounds can also
be computed on representatives:
\[
   \BIGLUB \{[\MMM]_{\MODELEQ} \ |\ \MMM \in S\ \} = [\BIGLUB S]_{\MODELEQ}
\]
and likewise for the greated lower bound.

Note that bisimilarity $\BISIM$ and $\MODELEQ$ do not coincide: the
former is strictly more discriminating than the latter, i.e.~$\BISIM
\subsetneq \MODELEQ$. Figure \ref{figure:counterexample} shows two
models that are $\MODELEQ$-equal but not bisimilar.

\input{figure:counterexample}

In the rest of this text, we will usually be sloppy and work with
concrete models instead of $\MODELEQ$-equivalence classes of models because the
quotienting process is straightfoward and not especially
interesting. We can do this because all relevant constructions in this
text are independent from the specific choice of representative.  Our
Haskell implementation, described in Section \ref{hahahaskell} uses a
slightly different approach: instead of equivalence classes, it uses
canonical representatives.  \martin{add more explanation, and
  integrate better with premiminaries}.

First we extend $\MODELLEQ$ on equivalence classes with bottom element
$\bot = [\bot]_{\MODELEQ}$.

\begin{theorem}
The collection of (equivalence classes of) models together with
$\bot$, and ordered by $\MODELLEQ$ is a complete lattice.
\end{theorem}
\begin{proof}
\martin{worth doing?}  Example: The topmost element in the lattice is
the model $( (\{w\}, \{\}, \{w \mapsto \Sigma\}), w)$ (for some state
$w$): this is the model with no transitions and no transition
restrictions.
\end{proof}


\subsubsection{Computing the simplest model satisfying a formula}
\label{simpl}

\NI In $\MODELLEQ $ we have a notion of model simplicity\martin{I'm not sure I like
this sentence}.  We can now
compute $\SIMPL{\phi}$, the simplest model w.r.t.~$\MODELLEQ $ that
satisfies $\phi$.

\begin{eqnarray*}
  \SIMPL{\top} &\ = \ & ( (\{v\}, \{\}, \{v \mapsto \Sigma\}), v)  \\
  \SIMPL{\fBang A} & = & ( (\{v\}, \{\}, \{v \mapsto A\}), v)  \\
  \SIMPL{\phi_1 \AND \phi_2} & = & \SIMPL{\phi_1} \sqcap \SIMPL{\phi_2}  \\
  \SIMPL{\langle a \rangle \phi} 
     & = & ( (S \cup \{w'\}, \rightarrow \cup (w' \xrightarrow{a} w), \lambda \cup \{w' \mapsto \Sigma\}]), w')  \\
		& & \mbox{where }\SIMPL{\phi} = ( (S, \rightarrow, \lambda), w) \mbox{and } w' \mbox{ is a new state} \\
                &&  \mbox{not appearing in }S 
\end{eqnarray*}

\input{figure:glb}



\NI Note that by our conventions, $\SIMPL{\phi}$ really returns a
$\MODELEQ$-equivalence class of models.

The only complex case is the clause for $\SIMPL{\phi_1 \AND \phi_2}$,
which uses the $\sqcap$ function, defined as follows, where we assume
that the sets of states in the two models are disjoint.

\begin{eqnarray*}
  \bot \sqcap \MMM  &\ =\ &  \bot  \\
  \MMM \sqcap \bot      & = &  \bot  
     \\
  \MMM \sqcap \MMM'
     & = & 
  \begin{cases}
    \mathsf{merge}(\MMM, \MMM') & \text{if}\ \mathsf{consistent}(\MMM, \MMM') \\
    \bot & \text{else}
  \end{cases}
\end{eqnarray*}

\NI The $\mathsf{consistent}$ predicate is true of models $m$ and $n$ if
the out-transitions on $m$'s root state respect the labelling on $n$'s
root state, and the out-transitions on $n$'s root state respect the
labelling on $m$'s root state. In other words:

\begin{eqnarray*}
  \mathsf{consistent}(\MMM, \MMM') 
     &\ \mbox{ iff }\ & 
  \begin{cases}
    \mathsf{out}(\MMM) \subseteq \mathsf{restriction}(\MMM') \mbox{ and}  \\
    \mathsf{out}(\MMM') \subseteq \mathsf{restriction}(\MMM) 
  \end{cases}
\end{eqnarray*}

\NI Here:

\[
\begin{array}{rcl}
  \mathsf{out}(((S,\rightarrow,\lambda),w)) 
     &\ =\ & \{ a \fOr \exists w' . w \xrightarrow{a} w'\}  \\
  \mathsf{restriction}(((S,\rightarrow,\lambda),w)) 
    & = & 
  \lambda(w) 
\end{array}
\]

\NI Now the $\mathsf{merge}$ function fuses two  models together:
\[
   \mathsf{merge}( ( (S, \rightarrow, \lambda), w),  ( (S', \rightarrow', \lambda'), w')) 
      \ =\ 
   ((S \cup S', \rightarrow \cup \rightarrow'_2, \lambda_2 \cup \lambda'_2), w)
\]
where:
\begin{eqnarray*}
  \rightarrow'_2 &\ =\ & \rightarrow' \mbox{ with } w' \mbox{ replaced by } w  \\
  \lambda_2 & = & \lambda \mbox{ with } w \mapsto \lambda(w) \cap \lambda'(w')  \\
  \lambda'_2 & = & \lambda' \mbox{ with } w' \mbox{ removed } 
\end{eqnarray*}

\NI It is easy to show that $\SIMPL{\cdot}$ has the following properties:

\begin{itemize}

\item $\SIMPL{\phi} \models \phi$.

\item If $\MMM' \models \phi$ and  $\MMM \MODELLEQ \MMM'$ then also  $\MMM \models \phi$.
 
\end{itemize}

\input{figure:lub}

\subsubsection{Computing Least Upper Bound ($\sqcup$)}
Define the least upper bound ($\sqcup$) of two models as:
\begin{eqnarray*}
\MMM \sqcup \bot & = & \MMM \\
\bot \sqcup \MMM & = & \MMM \\
(\CAL{L},w) \sqcup (\CAL{L}',w') & = & \mathsf{lub}(\CAL{L}, \CAL{L}', (\MMM_\top, z), \{(w, w', z)\})
\end{eqnarray*}
where $\MMM_\top$ is the topmost model $(\mathcal{W}=\{z\}, \rightarrow=\{\}, \lambda=\{z \mapsto \Sigma\})$ for some state $z$.
$\mathsf{lub}$ takes four parameters: the two eremic transition systems $\CAL{L}$ and $\CAL{L}'$, an accumulator representing the constructed result so far, and a list of state triples (each triple contains one state from each of the two input models plus the state of the accumulated result) to consider next.
It is defined as:
\begin{eqnarray*}
\mathsf{lub}(\CAL{L}, \CAL{L}', \MMM, \{\}) & = & \MMM \\
\mathsf{lub}(\CAL{L}, \CAL{L}', ((\mathcal{W}, \rightarrow, \lambda), y), \{(w,w',x)\} \cup R) & = & \mathsf{lub}(\CAL{L}, \CAL{L}', ((\mathcal{W} \cup \mathcal{W}', \rightarrow \cup \rightarrow', \lambda'), y), R' \cup R\}
\end{eqnarray*}
where:
\begin{eqnarray*}
\{(a_i, w_i, w'_i) \;|\; i = 1 ... n\} & = & \mathsf{sharedT}((\CAL{L},w), (\CAL{L}',w')) \\
\mathcal{W}' & = & \{x_i \;|\; i = 1 ... n\} \\
\rightarrow' & = & \{(x, a_i, x_i) \;|\; i = 1 ... n\} \\
\lambda' & = & \lambda [x \mapsto \lambda(w) \cup \lambda(w)'] \\
R' & = & \{(w_i, w'_i, x_i) \;|\; i = 1 ... n\}
\end{eqnarray*}
Here, $\mathsf{sharedT}$ returns the shared transitions between two models, and is defined as:
\[
\mathsf{sharedT}(((\mathcal{W}, \rightarrow, \lambda),w) ((\mathcal{W}', \rightarrow', \lambda'),w')) =  \{(a, x, x') \;|\; w \xrightarrow{a} x \land w' \xrightarrow{a}' x'\}
\]

\subsubsection{Characteristic formulae}

The function $\SIMPL{\cdot}$ goes from formulae to (equivalence
classes of) models. Now we go the other way: given a(n equivalence class of a) model $\MMM$, we
compute its characteristic formula $\CHAR{m}$. The formula
$\SIMPL{\MMM}$ characterises the model $\MMM$ in the following
sense. \martin{Check that they are true. Proofs?}

\begin{itemize}

\item  $\MMM \models \phi$ implies $\CHAR{\MMM} \models \phi$.

\item  $\MMM \models \CHAR{ \MMM' }$ exactly when $\MMM \MODELLEQ \MMM'$.

\item $\MMM = \BIGLUB \{\MMM' \ |\ \MMM' \models \CHAR{\MMM} \}$.

\end{itemize}

\martin{we must define $\BIGLUB$!}
\richard{It is defined below. Should we move it up?}

\NI This notion of characteristic formula is closely related to
characteristic formulae in Hennessy-Milner logic
\cite{AcetoL:chaforfata} and Hoare logics
\cite{HondaK:descriptive,ChargueraudA:provertcf}. Here is the
definition of $\CHAR{\cdot}$ (again we omit specifying that the function really
returns $\MODELEQ$-equivalence classes of models).

\begin{eqnarray*}
  \CHAR{\bot} &\ =\ & \langle a \rangle \top \AND ! \emptyset  \mbox{ for some symbol }a  \\
  \CHAR{\MMM, w} & = & \mathsf{bang}(\MMM,w) \AND \bigwedge_{(a,w') \in \mathsf{trans}(l,w)} \langle a \rangle \CHAR{\MMM, w'}  
\end{eqnarray*}

\martin{Note that in its current form $\CHAR{\bot}$ defines a
  relation, not a function, because $a$ an vary.}

\NI The functions $\mathsf{bang}(\cdot)$ and $\mathsf{trans}$ on
models are given by the following clauses.

\begin{eqnarray*}
  \mathsf{bang}((S,\rightarrow,\lambda),w) 
     & \ = \ & 
  \begin{cases}
    \top & \mbox{ if } \lambda(w) = \Sigma  \\
    ! \; \lambda(w) & \mbox{ otherwise }  
  \end{cases} \\
  \mathsf{trans}((S,\rightarrow, \lambda),w) & \ = \ & \{(a,w') | w \xrightarrow{a} w' \} 
\end{eqnarray*}

\NI Note that $\CHAR{\MMM}$ is finite if $\MMM$ contains no cycles and if
$\lambda(x)$ is either $\Sigma$ or finite for all states $x$.
Note also that $\SIMPL{\cdot}$ and $\CHAR{\cdot}$ are inverses of each other in that:

\begin{itemize}

\item $\SIMPL{\CHAR{\MMM}} \ = \  \MMM$. \martin{Is this set-theoretic equality?}

\item $\CHAR{\SIMPL{\phi}}$ iff $\phi$.\martin{is this $\vdash$ or $\models$?}

\end{itemize}

\NI We are now ready to prove completeness.  We will show that $\phi
\models \psi$ implies there is a derivation of $\phi \judge \psi$.  Our proof
will make use of two key facts\footnote{These lemmas are proved in the Appendices.}:

\begin{lemma}\label{lemma:completeness:4}
If $\MMM \models \phi$ then $\CHAR{\MMM} \judge \phi$.
\end{lemma}

\begin{lemma}\label{lemma:completeness:5}
For all formulae $\phi$, we can derive $\phi \judge \CHAR{\SIMPL{\phi}}$.
\end{lemma}

\martin{Add short explanation of Lemma \ref{lemma:completeness:4}}.

As to Lemma \ref{lemma:completeness:5}, $\SIMPL{\phi}$ is the simplest model
satisfying $\phi$, and $\CHAR{\MMM}$ is the simplest formula describing
$m$, so $\CHAR{\SIMPL{\phi}}$ is a simplified form of $\phi$. This lemma
states that EL has the inferential capacity to transform any
proposition into its simplified form.

With these two lemmas in hand, the proof of completeness is
straightforward.  Assume $\phi \models \psi$.  Then all models which satisfy
$\phi$ also satisfy $\psi$.  In particular, $\SIMPL{\phi} \models \psi$.  Then
$\CHAR{\SIMPL{\phi}} \judge \psi$ by Lemma \ref{lemma:completeness:4}.  But we
also have, by Lemma \ref{lemma:completeness:5}, $\phi \judge
\CHAR{\SIMPL{\phi}} $.  So by transitivity, we have $\phi \judge \psi$.  


\subsection{The standard translation from  \ELABR{} into 
            first-order logic}\label{standardTranslation}

We now present a translation from EL to first-order logic. We have two
key purposes in mind:

\begin{itemize}

\item To facilitate the comparison between EL and conventional
  first-order logic, to pin down precisely where EL and first-order
  logic differ and where they don't.

\item To enable technology transfer between EL and other logics. We
  are inspired here in particular by the standard translation of modal
  logic into first-order logic \cite{BlackburnP:modlog} which has
  allows the transfer of interesting results such as compactness to
  modal logic, but has also given rise to many interesting concepts in
  first-order logic.  Historically, fragments of first-order logic
  that were studied were defined by quantifier hierarchies. Modal
  logics picks out very different fragments. For example fragments
  closed under bisimulation, guarded fragments, fragments with
  restricted numbers of variables.

\end{itemize}

\input{figure:embedding}

\NI We will translate EL into a restricted fragment of first-order
logic (cf.~Figure \ref{figure:embedding}). The first-order signature
$\SSS$ has a nullary predicate $\top$, a family of unary predicates
$\RESTRICT{A}{\cdot}$, one for each finite subset $A \subseteq
\Sigma$, and a family of binary predicates $\ARROW{a}{x}{y}$, one for
each action $a \in \Sigma$.  The intended interpretation is as
follows.

\begin{itemize}

\item The universe is composed of states.

\item The predicate $\top$, which is true everywhere.

\item For each finite $A \subseteq \Sigma$ and each state $s$,  $\RESTRICT{A}{s}$
is true if 
  $\lambda(x) \subseteq A$.

\item A set of two-place predicates $\ARROW{a}{x}{y}$, one for each $a
  \in \Sigma$, where $x$ and $y$ range over states. $\ARROW{a}{x}{y}$
  is true if $x \xrightarrow{a} y$.


\end{itemize}

\NI Note that if $\Sigma$ is infinite, then $\RESTRICT{A}{\cdot}$ and
$\ARROW{a}{\cdot}{\cdot}$ are infinite families of relations.


 Choose two fixed variables $x, y$, let $a$ range over actions in
$\Sigma$, and $A$ over finite subsets of $\Sigma$. Then the restricted
fragment of FOL that is the target of our translation is given by the
following grammar, where $w, z$ range over $x, y$.

\begin{GRAMMAR}
  \phi 
     &\quad ::= \quad&
  \top \fOr \ARROW{a}{w}{z}\fOr \RESTRICT{A}{z} \fOr \phi \AND \psi \fOr \exists x. \phi 
\end{GRAMMAR}

\NI Notice that this fragment of FOL has no negation, disjunction,
implication, or universal quantification. 

The translations $\SEMB{\phi}_x$ and $\SEMB{\phi}_y$ of an EL formula
$\phi$ are given relative to a state, denoted by either $x$ or $y$.

\[
\begin{array}{rclcrcl}
  \SEMB{\top}_x & \ = \ & \top  
     &\quad& 
  \SEMB{\top}_y & \ = \ & \top 
     \\
  \SEMB{\phi \AND \psi}_x & = & \SEMB{\phi}_x \AND \SEMB{\psi}_x  
     && 
  \SEMB{\phi \AND \psi}_y & = & \SEMB{\phi}_y \AND \SEMB{\psi}_y  
     \\
  \SEMB{\langle a \rangle \phi}_x & = & \exists y.(\ARROW{a}{x}{y} \AND \SEMB{\phi}_y)  
     &&
  \SEMB{\langle a \rangle \phi}_y & = & \exists x.(\ARROW{a}{y}{x} \AND \SEMB{\phi}_x)  
     \\
  \SEMB{\fBang A}_x & = & \RESTRICT{A}{x}
     &&
  \SEMB{\fBang A}_y & = & \RESTRICT{A}{y}
\end{array}
\]

\NI The translations on the left and right are identical except for
switching $x$ and $y$. We continue with some example translations.

\[
   \SEMB{\langle a \rangle \top \AND \fBang \{a\}}_x 
      = 
   \exists y.(\ARROW{a}{x}{y} \AND \top ) \AND \RESTRICT{\{a\}}{x}
\]

\martin{Shall we discuss 1 or 2 more? Maybe one that illustrates the
variable switching?}

\NI We now establish the correctness of the encoding. The key issue
issue is that not every first-order model of our first-order signature
corresponds to an eremic model. The problem is that eremic models have
constraints that are not enforced by our signature, e.g.~$s \TRANS{a}
t$ implies that $a \in \lambda(s)$. Such models are 'junk' from the
point of view of \ELABR{}. 

We deal with this problem following ideas from modal logic
\cite{BlackburnP:modlog}: we add a translation $\SEMB{\LLL}$ for
eremic transition systems, and then prove the following theorem.

\begin{theorem}[correspondence theorem]\label{correspondence:theorem:1}
Let $\phi$ be an \ELABR{} formula and $\MMM = (\LLL, s)$ an eremic
model.
\[
   \MMM \models \phi \quad  \text{iff} \quad \SEMB{\LLL} \models_{x \mapsto s} \SEMB{\phi}_x.
\]
And likewise for $\SEMB{\phi}_y$.
\end{theorem}

\NI Before proving the theorem, we define $\SEMB{\LLL}$, which, given
an eremic transition system $\LLL$, produces a corresponding
first-order model for the signature $\SSS$ introduced above. The
translation is simple.

\begin{definition}
Let $\LLL = (S, \rightarrow, \lambda)$ be an eremic transition
system. Clearly $\LLL$ gives rise to an $\SSS$-model $\SEMB{\LLL}$ as
follows.
\begin{itemize}

\item The universe is the set $S$ of states.

\item The relation symbols are interpreted as follows.

  \begin{itemize}

    \item $\top^{\SEMB{\LLL}}$ always holds.

    \item $\mathsf{Restrict}_{A}^{\SEMB{\LLL}} = \{ s \in S\ |\ \lambda(s) \subseteq A\}$.

    \item $\mathsf{Arrow^{\SEMB{\LLL}}}_{a} = \{(s, t) \in S \times S\ |\ s \TRANS{a} t\}$.

  \end{itemize}
\end{itemize}
\end{definition}

\NI We are now ready to prove Theorem \ref{correspondence:theorem:1}.
\begin{proof}
By induction on the structure of $\phi$. The cases $\top$ and $\phi_1
\AND \phi_2$ are straightfoward.  The case $\MAY{a}\psi$ is handeled
as follows.
\begin{eqnarray*}
  \lefteqn{
  \SEMB{\LLL} \models_{x \mapsto s} \SEMB{\MAY{a}\psi}_x}\hspace{5mm} 
     \\
     &\quad \text{iff}\quad &
  \SEMB{\LLL} \models_{x \mapsto s} \exists y.(\ARROW{a}{x}{y} \AND \SEMB{\psi}_y) 
     \\
     &\text{iff}&
  \text{exists}\ t \in S. \SEMB{\LLL} \models_{x \mapsto s, y \mapsto t} \ARROW{a}{x}{y} \AND \SEMB{\psi}_y
     \\
     &\text{iff}&
  \text{exists}\ t \in S. \SEMB{\LLL} \models_{x \mapsto s, y \mapsto t} \ARROW{a}{x}{y} \ \text{and}\ \SEMB{\LLL} \models_{x \mapsto s, y \mapsto t}  \SEMB{\psi}_y
     \\
     &\text{iff}&
  \text{exists}\ t \in S. s \TRANS{a} t \ \text{and}\ \SEMB{\LLL} \models_{x \mapsto s, y \mapsto t}  \SEMB{\psi}_y
     \\
     &\text{iff}&
  \text{exists}\ t \in S. s \TRANS{a} t \ \text{and}\ \SEMB{\LLL} \models_{y \mapsto t}  \SEMB{\psi}_y \qquad (\text{as $x$ is not free in $\psi$})
     \\
     &\text{iff}&
  \text{exists}\ t \in S. s \TRANS{a} t \ \text{and}\ \MMM \models \psi
     \\
     &\text{iff}&
  \MMM \models \MAY{a}\psi  
\end{eqnarray*}

\NI Finally, if $\phi$ is $!A$ the derivation comes straight from the
definitions.
\begin{eqnarray*}
  \SEMB{\LLL} \models_{x \mapsto s} \SEMB{!A}_x
    &\quad \text{iff}\quad &
  \SEMB{\LLL} \models_{x \mapsto s} \RESTRICT{A}{x}
     \\
     &\text{iff}&
  \lambda(s) \subseteq A
     \\
     &\text{iff}&
  \MMM \models\ !A.
\end{eqnarray*}

\end{proof}

\subsection{Compactness}

\NI First-order logic has compactness: a set $S$ of sentences has a
model exactly when every finite subset of $S$ does \cite[Chapter
  4.3]{EndertonHB:matinttl}. What about \ELABR{}? 

We can prove compactness of modal logics using the standard
translation from modal to first-order logic \cite{BlackburnP:modlog}:
we start from a set of modal formula such that each finite subset has
a model. We translate the modal formulae and models to first-order
logic, getting a set of first-order formulae such that each finite
subset has a first-order model. By compactness of first-order logic we
obtain a first-order model of the translated modal formulae. Then we
translate that first-order model back to modal logic, obtaining a
model for the original modal formulae, as required.

Unfortunately we cannot do the same with the translation from \ELABR{}
to first-order logic presented in the previous section. The problem
are the first-order models termed 'junk' above: they do not correspond
to eremic transition systems.  For example the constraint $s
\TRANS{a} t$ implies $a \in \lambda(s)$ might be violated. After all,
merely having signature $\SSS$ is not strong enough a constraint. The
target language of the translation from the previous section is not
expressive enough to have formulae that can guarantee such
constraints.  As we have no reason to belive that the first-order
model whose existence is guarnateed by compactness isn't 'junk', we
cannot use this translation.

We solve this problem with a second translation from \ELABR{} to
first-order logic, this time into a more expressive fragment were we
can constrain first-order models enough to ensure that they always can
be translated back to \ELFULL{}.

The second embedding translates \ELFULL{} to two-sorted first-order
logic. The many-sorted first-order signature $\SSS'$ is given as follows.
\begin{itemize}

\item $\SSS'$ has two sorts, states and actions. 

\item The action constants are given by $\Sigma$. There
are no state constants. 

\item $\SSS'$ has a nullary predicate $\top$.

\item A binary predicate $\ALLOWED{}{\cdot}{\cdot}$. The intended
  meaning of $\ALLOWED{}{x}{a}$ is that at the state denoted by $x$ we
  are allowed to do the action $a$.

\item A ternary predicate $\ARROWTWO{}{\cdot}{\cdot}{\cdot}$ where
  $\ARROWTWO{}{x}{a}{y}$ means that there is a transition from the
  state denoted by $x$ to the state denoted by $y$, and that
  transition is labelled $a$.

\end{itemize}

\NI So $\SSS'$ is a relational signature, i.e.~has no function
symbols.  The intended interpretation should should be
clear.\martin{Phrase this better.}

With the target logic in place, we can now present a second encoding
$\SEMBTWO{\phi}_x$ of \ELABR{} formulae.

\begin{eqnarray*}
  \SEMBTWO{\top}_x & \ = \ & \top
     \\
  \SEMBTWO{\phi \AND \psi}_x & = & \SEMBTWO{\phi}_x \AND \SEMBTWO{\psi}_x
     \\
  \SEMBTWO{\langle a \rangle \phi}_x & = & \exists^{state} y.(\ARROWTWO{}{x}{a}{y} \AND \SEMBTWO{\phi}_y)
     \\
  \SEMBTWO{\fBang A}_x & = & \forall^{action} a.(\ALLOWED{}{x}{a} \IMPLIES a \in A) 
\end{eqnarray*}

\NI Here we use $\exists^{state}$ to indicate that the quantifier ranges
of the sort of states, and $\forall^{action}$ for a quantifier ranging
over actions. The expression $a \in A$ is a shorthand for the
first-order formula
\[
   a = a_1 \OR a = a_2 \OR \cdots \OR a = a_n
\]
assuming that $A = \{a_1, ..., a_n\}$. Since by definition, $A$ is always a finite
set, this is well-defined.

Note that the translation above could be restricted to a two-variable
fragment. Moreover, the standard reduction from many-sorted to
one-sorted first-order logic, does not increase the number of
variables used (although predicates are added, one per sort)
\cite{EndertonHB:matinttl}. For simplicity we will not consider this
matter further.

Before we can state and prove a correspondence theorem for
$\SEMBTWO{\phi}_x$ along the lines of Theorem
\ref{correspondence:theorem:1}, we must also translate eremic
  transition systems $\SEMBTWO{\LLL}$.

\begin{definition}
Let $\LLL = (S, \rightarrow, \lambda)$ be an eremic transition
system. Clearly $\LLL$ gives rise to an $\SSS'$-model $\SEMBTWO{\LLL}$
as follows.
\begin{itemize}

\item For each constant $a \in \Sigma$, $a^{\SEMBTWO{\LLL}}$ is $a$ itself.

\item The sort of states is interpreted by the set $S$.

\item The sort of actions is interpreted by the set $\Sigma$.

\item The relation symbols are interpreted as follows.

  \begin{itemize}

    \item $\top^{\SEMBTWO{\LLL}}$ always holds.

    \item $\ALLOWED{\SEMBTWO{\LLL}}{s}{a}$ holds whenever $a \in \lambda(s)$.

    \item $\ARROWTWO{\SEMBTWO{\LLL}}{s}{a}{t}$ holds whenver $s \TRANS{a} t$.

  \end{itemize}
\end{itemize}
\end{definition}


\begin{theorem}[correspondence theorem]\label{correspondence:theorem:2}
Let $\phi$ be an \ELABR{} formula and $\MMM = (\LLL, s)$ an eremic
model.
\[
   \MMM \models \phi \quad  \text{iff} \quad \SEMBTWO{\LLL} \models_{x \mapsto s} \SEMBTWO{\phi}_x.
\]
\end{theorem}
\begin{proof}
The proof proceeds by induction on the structure of $\phi$ and is
similar to that of Theorem \ref{correspondence:theorem:2}.
The case for the may modality proceeds as follows.  

\begin{alignat*}{2}
  \MMM \models \MAY{a}\phi
     &\quad\text{iff}\quad 
  \text{exists state $t$ with }\ s \TRANS{a} t\ \text{and}\ (\LLL, t) \models \phi \\
     &\quad\text{iff}\quad
  \text{exists state $t$ with }\ s \TRANS{a} t\ \text{and}\ \SEMBTWO{\LLL} \models_{y \mapsto t} \SEMBTWO{\phi}_y &\qquad& \text{by (IH)}\\
     &\quad\text{iff}\quad
  \SEMBTWO{\LLL} \models_{x \mapsto s} \exists^{state} y.(\ARROWTWO{}{x}{a}{y} \AND \SEMBTWO{\phi}_y) \\
     &\quad\text{iff}\quad
   \SEMBTWO{\LLL} \models_{x \mapsto s} \SEMBTWO{\MAY{a}{\phi}}_x
\end{alignat*}
\martin{the 2nd to last inference may need elaboration!}

Finally $!A$.
\begin{alignat*}{2}
  \MMM \models !A
     &\quad\text{iff}\quad
  \lambda (s) \subseteq A \\
      &\quad\text{iff}\quad
  \text{for all }\ a \in \Sigma. a \in A \\
     &\quad\text{iff}\quad
  \SEMBTWO{\LLL} \models_{x \mapsto s} \forall^{action} a. (\ALLOWED{}{x}{a} \IMPLIES a \in A) \\
     &\quad\text{iff}\quad
  \SEMBTWO{\LLL} \models_{x \mapsto s} \SEMBTWO{!A}_x
\end{alignat*}
\martin{again, some steps need elaboration? Also should this go in the appendix?}

\end{proof}

\NI We now use the translation $\SEMBTWO{\phi}_x$ to show that \ELABR{} must also have compactness. The key steps in the proof are
simple, following standard techniques from modal logic
\cite{BlackburnP:modlog}:

\begin{enumerate}

\item Choose a set $T$ of \ELABR{} formulae, such that each finite
  subset $T'$ of $T$ has an eremic model $(\LLL, s)$.

\item Using the translations gives a set $\SEMBTWO{T} =
  \{\SEMBTWO{\phi}\ |\ \phi \in T\}$ of first-order formulae such that
  each finite subset has a first-order model $\SEMBTWO{\LLL}$.

\item By compactness of first-order logic, we can find a first-order
  model $\CAL{M}$ of $\SEMBTWO{T}$.

\item\label{compactness:step:4} Convert $\CAL{M}$ into an eremic transition system
  $\CAL{M}^{\sharp}$ such that $(\CAL{M}^{\sharp}, s) \models T$.

\end{enumerate}

\NI The problematic step is (\ref{compactness:step:4}), for how would
we know that the model $\CAL{M}$ can be converted back to an eremic
transition system? Why should $\CAL{M}$ exhibit admissibility or
well-sizedness?  The mere fact that $\CAL{M}$ is a first-order model
of signature $\SSS'$ is not strong enough to guarantee these
properties.  We deal with this in two ways. To ensure admissibility,
we define a formula that guarantees that models satisfying the formula
are admissible.
\begin{eqnarray*}
   \phi_{admis} 
      & \ =\ &
   \forall^{state} s.\forall^{action} a.\forall^{state} t.( \ARROWTWO{}{s}{a}{t} \IMPLIES \ALLOWED{}{s}{a})
\end{eqnarray*}

\begin{lemma}\label{compactness:lemma:23399}
If $\LLL$ is an eremic transistion system then $\SEMBTWO{\LLL} \models
\phi_{admis}$.
\end{lemma}

\begin{proof}
Straightforward from the definitions.

\end{proof}

\NI We can now add, without changing satisfiability, $\phi_{admis}$ to
any set of first-order formulae that has a model that is the
translation of an eremic model.

%% We deal with the absence of well-sizedness by 

%% First we add a formula $\phi_a$ for each action $a \in \Sigma$.
%% \begin{eqnarray*}
%%    \phi_{a} 
%%       & = &
%%    \exists^{action} c. a = c 
%% \end{eqnarray*}

%% \begin{lemma}\label{compactness:lemma:666}
%% If $\LLL$ is an eremic transistion system then $\SEMBTWO{\LLL} \models
%% \phi_{a}$ for all $a \in \Sigma$.
%% \end{lemma}

%% \begin{proof}
%% Straightforward from the definitions.
%% 
%% \end{proof}

\begin{definition}
Let $\LLL = (S, \rightarrow, \lambda)$ be an eremic transition system
and $X$ a set, condidered to contain actions. The \emph{restriction of
  $\LLL$ to $X$}, written $\LLL \setminus X$ is the eremic model $(S,
\rightarrow', \lambda')$ where $\rightarrow' = \{(s, a, t) \in
\rightarrow \ |\ a \notin X\}$, and for all states $s$ we set:
\[
   \lambda'(s) 
        =
   \begin{cases}
       \lambda(s) \setminus  X & \text{whenever}\ \lambda(s) \neq \Sigma \\
       \Sigma & \text{otherwise}
   \end{cases}
\]

\end{definition}

\begin{lemma}\label{compactness:lemma:1717}
Let $\phi$ be an \ELABR{} formula and $X$ be a set such that no action
occuring in $\phi$ is in $X$. Then:
\[
   (\LLL, s) \models \phi
      \quad\text{iff}\quad
   (\LLL \setminus X, s) \models \phi.
\]
\end{lemma}
\begin{proof}
By straightforward induction on the structure of $\phi$, using the
fact that by assumption $X$ only contains actions not occuring in
$\phi$.  
\end{proof}

\begin{definition}
Let $\CAL{M}$ be a first-order model for the signature $\SSS'$.
We construct an eremic transition system
$\CAL{M}^{\sharp} = (S, \rightarrow, \lambda)$.
\begin{itemize}

\item The actions $\Sigma$ are given by the $\CAL{M}$ interpretation of actions.

\item The states $S$ are given by the $\CAL{M}$ interpretation of states.

\item The reduction relation $s \TRANS{a} t$ holds exactly when
  $\ARROWTWO{\CAL{M}}{s}{a}{t}$.

\item The function $\lambda$ is given by the following clause:
  \[
     \lambda(s) 
        =
     \begin{cases} 
       X & \text{whenever}\ X = \{a \ |\ \ALLOWED{\CAL{M}}{s}{a} \}\ \text{ is finite} \\
       \Sigma & \text{otherwise}
     \end{cases}
  \]

\end{itemize}

\end{definition}

\begin{lemma}
If $\CAL{M}$ be a first-order model for $\SSS'$ such that $\CAL{M}
\models \phi_{admis}$.  Then $\CAL{M}^{\sharp}$ is an eremic
transition system with actions $\Sigma$.
\end{lemma}
\begin{proof}
Immediate from the definitions.

\end{proof}

\begin{theorem}[correspondence theorem]\label{correspondence:theorem:223}
Let $\CAL{M}$ be a first-order model for the signature $\SSS'$ such that
 $\CAL{M} \models \phi_{admis}$.
Then we have for all \ELABR{} formulae $\phi$ with
actions from $\Sigma$:
\[
   \CAL{M} \models_{x \mapsto s} \SEMBTWO{\phi}_x 
        \quad  \text{iff} \quad 
   (\CAL{M}^{\sharp} \setminus X, s) \models \phi.
\]
\end{theorem}
Here $X$ is the set of all elements in the universe of $\CAL{M}$ interpreting
actions that are not in $\Sigma$.
\begin{proof}
The proof proceeds by induction on the structure of $\phi$. \textbf{To do.}
\end{proof}

\begin{definition}
Let $T$ be a set of \ELABR{} formulae, and $\MMM$ an eremic model.  We
write $\MMM \models T$ provided $\MMM \models \phi$ for all $\phi \in
T$.  We say $T$ is \emph{satisfiable} provided $\MMM \models T$.
\end{definition}

\begin{theorem}[Compactness of \ELFULL{}]
A set $T$ of \ELABR{} formulae is satisfiable iff each finite subset of
$T$ is satisfiable.
\end{theorem}
\begin{proof}
For the non-trivial direction, let $T$ be a set of \ELABR{} formulae
such that any finite subset has an eremic model. Define 
\[
  \SEMBTWO{T} 
     \ =\ 
  \{\SEMBTWO{\phi}\ |\ \phi \in T\} 
     \qquad\qquad
  T^*
     \ =\ 
  \SEMBTWO{T} \cup \{\phi_{admis}\} \cup \{ \phi_a\ |\ a \in \Sigma\}
\]
which both are sets of first-order formulae. Clearly each finite subset $T'$ of 
$T^*$ has a first-order model. Why? First consider the subset $T'_{EL}$ of $T'$
which is given as follows.
\[
   T'_{EL} \ =\ \{ \phi \in T\ |\ \SEMBTWO{\phi} \in T' \}
\]
Since $T'_{EL}$ is finite, by assumption there is an eremic model 
\[
   (\LLL, s) \models T'_{EL}
\]
which means we can apply Theorem \ref{correspondence:theorem:223} to get
\[
   \SEMBTWO{\LLL} \models_{x \mapsto s} \SEMBTWO{T'_{EL}},
\]
By construction $T' \setminus \SEMBTWO{T'_{EL}} \subseteq
\{\phi_{admis}\} \cup \{ \phi_a\ |\ a \in \Sigma\}$, so all we have to
show for $T'$ to have a model is that
\[
    \SEMBTWO{\LLL} \models_{x \mapsto s} \{\phi_{admis}\} \cup \{ \phi_a\ |\ a \in \Sigma\},
\]
but that is a direct consequence of Lemma
\ref{compactness:lemma:23399}.  That
means each finite subset of $T^*$ has a model and by appealing to
compactness of first-order many-sorted logic (which is an immediate
consequence of compactenss of one-sorted first-order logic
\cite{EndertonHB:matinttl}), we know there must be a first-order model
$\CAL{M}$ of $T^*$, i.e.
\[
   \CAL{M} \models T^*.
\]
Since $\CAL{M} \models \phi_{admis}$ and $\CAL{M} \models \phi_a$ for all actions $a$, 
we can apply Theorem \ref{correspondence:theorem:223} that also
\[
   (\CAL{M}^{\sharp} \setminus X, s) \models T
\]
where $X$ is the set of all actions in $\CAL{M}^{\sharp}$ that are not
in $\Sigma$. Hence $T$ is satisfiable.
 
\end{proof}





