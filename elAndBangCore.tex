\section{Core eremic logic: the EL$[\AND, !]$ fragment}\label{coreEL}

\subsection{Syntax}

\begin{definition} Given a set $\mathcal{S}$ of symbols, with $a$ ranging over
$\mathcal{S}$, and $A$ ranging over finite subsets of $\mathcal{S}$,
the formulae of EL$[\AND, !]$ are given by:

\begin{GRAMMAR}
  \phi 
     &\quad ::= \quad & 
  \top 
     \VERTICAL 
  \phi_1 \AND \phi_2  
     \VERTICAL 
  \MAY{a}{\phi}
     \VERTICAL 
  \fBang A 
\end{GRAMMAR}

\NI The $!$ operator is used to restrict the allowable transitions
coming out of a state.  Intuitively, $\fBang A$ means that the
\emph{only} transitions coming out of the current state are those
specified in $A$.
\end{definition}

\subsection{Semantics}

\begin{definition}
A {\bf model} is a triple $(\mathcal{W}, \rightarrow, \lambda)$,
containing a Labeled Transition System (a set of states $\mathcal{W}$,
and a transition relation $\rightarrow \; \subseteq \; \mathcal{W}
\times \mathcal{S} \times \mathcal{W}$), together with a
node-labelling $\lambda$ that maps each element of $\mathcal{W}$ to a
subset of $\mathcal{S}$.
\end{definition}
The intended interpretation is that $\lambda(w)$ is the set of allowed transition symbols emanating from $w$.
The $\lambda$ function is the semantic counterpart of the $!$ operator.

Now, for a model to be valid, we insist that the transitions coming out of a node $w$ are a subset of the allowed transitions in $\lambda(w)$:
\begin{definition}
A model $(\mathcal{W}, \rightarrow, \lambda)$ is {\bf valid} iff for all $w \in \mathcal{W}$, $ \{s \fOr \exists w' \; w \xrightarrow{s} w'\} \subseteq \lambda(w)$.
\end{definition}

\begin{definition}
A {\bf  model} is a pair $(l,w)$, where $m$ is a \emph{valid} model of the form $(\mathcal{W}, \rightarrow, \lambda)$, and $w$ is a distinguished state in $\mathcal{W}$.
\end{definition}
Formulae are interpreted in a  model $(l,w)$:
\begin{eqnarray*}
(l,w) & \models & \top  \mbox{ always }  \\
(l,w) & \models & \phi_1 \AND \phi_2 \mbox{ iff } (l,w)  \models \phi_1 \mbox { and } (l,w) \models \phi_2  \\
(l,w) & \models & \langle a \rangle \phi \mbox{ iff there is a } w \xrightarrow{a} w' \mbox { such that } (l,w') \models \phi  \\
(l,w) & \models & \fBang A \mbox{ iff } \lambda(w) \subseteq A
\end{eqnarray*}
Note that if a model is valid then $(l,w) \models \fBang A$ implies $\{s \fOr \exists w' \; w \xrightarrow{s} w'\} \subseteq A$.
From now on, we will restrict ourselves to valid models.

\input{figure:elAndBang:models}


\input{figure:elAndBangRules}

\subsection{Inference Rules}

This section presend the inference rules for EL.
In EL, a judgement is of the form:

\[
  X \judge Y
\]

\NI Here, $X$ and $Y$ are \emph{single formulae}, not sequents.  To
avoid the need for structural inference rules, we restrict sequents to
single formulae on the left and right hand side. Figure
\ref{figure:elAndBangRules} presents all rules.  EL proof rules can be
grouped in two parts: standard rules and rules unique to EL.  Standard
rules are [\RULENAME{Identity}], [\RULENAME{$\top$-Right}],
[\RULENAME{$\bot$-Left}], [\RULENAME{Transitivity}],
[\RULENAME{$\AND$-Left 1}], [\RULENAME{$\AND$-Left 2}] and
[\RULENAME{$\AND$-Right}] hardly need explanation as they are variants
of familiar rules for propositional logic, see
e.g.~\cite{TroelstraAS:basprot,vanDalenD:logstr}.  We now explain the
rules that give EL's its distinctive properties: the relations betwen
$\langle \rangle$, $!$ and $\bot$.

The rule [\RULENAME{$\bot$-Right 1}] axiom captures the core
\emph{exclusion} property of !: for example if $A = \{male, female\}$
then $\MAY{orange}{X}$ is incompatible with $!A$. Thus $!A \AND
\MAY{orange}{X}$ must be false.

The rule [\RULENAME{$\bot$-Right 2}] expresses that falsity is 'global'
  and cannot be surpressed by prefixing. For example
  $\MAY{orange}{\bot}$ is false, simply because $\bot$ is already
  false.

Relatedly, the rule [\RULENAME{Transition Normal}] enables us to
prefix an inference with a may-modality. For example \martin{add good
  example here.}. Note that it is vital for soundness that $X$ in $X
\judge Y$ is a single formula. If we used transitional sequents $X_1, ..., X_n \judge Y$,
then the rule
\[
   \ONEPREMISERULE
   {
     X_1, ..., X_n \judge Y
   }
   {
     \MAY{a}{X_1}, ..., \MAY{a}{X_n} \judge \MAY{a}{Y}
   }
\]
is unsound. \martin{explain why, and why this is significant}. This
restriction is also in place in \cite{GaySJ:typcalosp} where a
Curry-Howard corrospondence between a fragment of linear logic
\cite{GirardJY:linlog,GirardJY:protyp} and a process calculus is
introduced. We discuss the relationship between EL and linear logic in
general, and linear logic's additive conjunction in Section
\ref{conclusion}.


The three rules [\RULENAME{!-Left}, \RULENAME{!-Right 1},
  \RULENAME{!-Right 2}] jointly express of the subset relation
$\subseteq$ on sets of symbols relates to provability. Readers
familiar with object-oriented programming will recognise
[\RULENAME{!-Left}] as contra-variant subtyping and [\RULENAME{!-Right
    1}] as covariant subtyping. Honda \cite{HondaK:thetypftpc}
develops a full theory of subtyping based on similar ideas.  All three
rules embody the intuition that whenever $A \subseteq A'$ then
asserting that $!A'$ is as strong as, or a stronger statement than
$!A$. [\RULENAME{!-Left}] simply states that we can always strengthen
our premise, while [\RULENAME{!-right 1}] allows us to weaken the
premise. \martin{add an intuitive explanation for [\RULENAME{!-right 2}]!}!

Note that the logic has no axioms. One reason for a purely rule-based
presentation is the absence of implication in the present fragment of
EL. \martin{explain in more detail!}

We close this subsection with a key meta-theorem.

\begin{theorem}\label{theorem:elAndBang:soundComplete}
The rules in Figure \ref{figure:elAndBangRules} are sound and complete:
\begin{enumerate}

\item\label{theorem:elAndBang:sound} (Soundness) $X \judge Y$ implies $X \models Y$.

\item\label{theorem:elAndBang:complete} (Completeness) $X \models Y$ implies $X \judge Y$.

\end{enumerate}
\end{theorem}

\NI Soundness is immediate from the definitions. Proof of completeness is
deferred to Section \ref{completenessProof}. 

\subsection{Example inferences}

We give some example inferences that illustrate how EL is used in
practise.
\martin{Add some example assertions here, for example some of those we
  use later.}

\subsection{Proof of completeness}\label{completenessProof}

\NI We now prove completeness of the rules in Figure
\ref{figure:elAndBangRules} (Theorem
\ref{theorem:elAndBang:soundComplete}.\ref{theorem:elAndBang:complete}).
The proof requires the development of additional technology which is
useful in other contexts as well.

\begin{itemize}

\item An ordering $\LEQ$ on models, which enables us to speak of the
  simplest model satisfying a formula.

\item An algorithm which gives the simplest model for a formula.

\item An algorithm which gives the a formula characterising a model.

\end{itemize}

\NI We now develop these three in turn and then prove completeness.

\subsubsection{A partial ordering on models}

\NI In logic it is often useful to speak about the simplest model
satisfying a given formula, cf.~the term models and Herbrand universes
of first-order logic\martin{is that true?}. We use the notion of simulation to define an
order $\LEQ$ on models, which gives rise to a bounded lattice of
models.

\begin{definition}
$(l,w) \LEQ (l',w')$ if there is a simulation $\RRR$ from $l'$ to $l$
  with $(w',w) \in \RRR$
\end{definition}

\NI Intuitively, $m \LEQ n$ if $m$ can match all the transitions of
$n$ while respecting the transitions-restrictions.\martin{this is
  probably a standard construction on LTS, models of modal logics.}

To make our models into a lattice\martin{do you mean a \emph{bounded}
  lattice?}, we add a bottom element $\bot$ and stipulate that $\bot
\LEQ m$ for all models $m$.  The topmost element in the lattice is the
model $( (\{w\}, \{\}, \{w \mapsto \mathcal{S}\}), w)$ (for some state
$w$): this is the model with no transitions and no transition
restrictions.

\subsubsection{Computing the simplest  model satisfying a formula}

Now that we have a notion of model simplicity, we compute $\mu(X)$,
the simplest model w.r.t.~$\LEQ$ that satisfies $X$.

\begin{eqnarray*}
  \mu (\top) &\ = \ & ( (\{v\}, \{\}, \{v \mapsto \mathcal{S}\}), v)  \\
  \mu (\fBang A) & = & ( (\{v\}, \{\}, \{v \mapsto A\}), v)  \\
  \mu (X_1 \AND X_2) & = & \mu(X_1) \sqcap \mu(X_2)  \\
  \mu (\langle a \rangle X) 
     & = & ( (\mathcal{W} \cup \{w'\}, \rightarrow \cup (w' \xrightarrow{a} w), \lambda \cup \{w' \mapsto \mathcal{S}\}]), w')  \\
		& & \mbox{where }\mu(X) = ( (\mathcal{W}, \rightarrow, \lambda), w) \mbox{and } w' \mbox{ is a new state} \\
                &&  \mbox{not appearing in }\mathcal{W} 
\end{eqnarray*}

\NI The only complex case is the clause for $\mu (X_1 \AND X_2)$,
which uses the $\sqcap$ function, defined as follows, where we assume
that the sets of states in the two models are disjoint.

\begin{eqnarray*}
  \bot \sqcap m  &\ =\ &  \bot  \\
  m \sqcap \bot      & = &  \bot  
     \\
  m \sqcap n 
     & = & 
  \begin{cases}
    \mathsf{merge}(m, n) & \text{if}\ \mathsf{consistent}(m, n) \\
    \bot & \text{else}
  \end{cases}
\end{eqnarray*}

\NI The $\mathsf{consistent}$ predicate is true of models $m$ and $n$ if
the out-transitions on $m$'s root node respect the labelling on $n$'s
root node, and the out-transitions on $n$'s root node respect the
labelling on $m$'s root node. In other words:

\begin{eqnarray*}
  \mathsf{consistent}(m, n) 
     &\ \mbox{ iff }\ & 
  \begin{cases}
    \mathsf{out}(m) \subseteq \mathsf{restriction}(n) \mbox{ and}  \\
    \mathsf{out}(n) \subseteq \mathsf{restriction}(m) 
  \end{cases}
\end{eqnarray*}

\NI Here:

\[
\begin{array}{rcl}
  \mathsf{out}(((\mathcal{W},\rightarrow,\lambda),w)) 
     &\ =\ & \{ s \fOr \exists x . w \xrightarrow{s} x \}  \\
  \mathsf{restriction}(((\mathcal{W},\rightarrow,\lambda),w)) 
    & = & 
  \lambda(w) 
\end{array}
\]

\NI Now the $\mathsf{merge}$ function fuses two  models together:
\[
   \mathsf{merge}( ( (\mathcal{W}, \rightarrow, \lambda), w),  ( (\mathcal{W}', \rightarrow', \lambda'), w')) 
      \ =\ 
   ((\mathcal{W} \cup \mathcal{W}', \rightarrow \cup \rightarrow'_2, \lambda_2 \cup \lambda'_2), w)
\]
where:
\begin{eqnarray*}
  \rightarrow'_2 &\ =\ & \rightarrow' \mbox{ with } w' \mbox{ replaced by } w  \\
  \lambda_2 & = & \lambda \mbox{ with } w \mapsto \lambda(w) \cap \lambda'(w')  \\
  \lambda'_2 & = & \lambda' \mbox{ with } w' \mbox{ removed } 
\end{eqnarray*}

\NI It is easy to show that $\mu$ has the following properties:

\begin{itemize}

\item $\mu(\phi) \models \phi$.

\item If $n \models \phi$ and  $m \LEQ n$ then also  $m \models \phi$.
 
\end{itemize}

\subsubsection{Defining $\theta$ - a Formula that Characterises a Model}

The function $\mu(\cdot)$ goes form formulae to models. Now we go the
other way: given a model $m$, we compute its characteristic formula
$\theta(m)$. The formula $\mu(m)$ characterises the model $m$ in the
following sense. \martin{Check that they are true. Proofs?}

\begin{itemize}

\item  $m \models X$ implies $\theta(m) \models X$.

\item  $m \models \theta( m' )$ exactly when $m \LEQ m'$.

\item $m = \BIGLUB \{m' \ |\ m' \models \theta(m) \}$.

\end{itemize}

\NI This notion of characteristic formula is closely related to
characteristic formulae in Hennessy-Milner logic
\cite{AcetoL:chaforfata} and Hoare logics
\cite{HondaK:descriptive,ChargueraudA:provertcf}. Here is the
definition of $\theta$.

\begin{eqnarray*}
  \theta(\bot) &\ =\ & \langle a \rangle \top \AND ! \{ \} \mbox{ for some symbol }a  \\
  \theta(l, w) & = & \mathsf{bang}(l,w) \AND \bigwedge_{(s,w') \in \mathsf{trans}(l,w)} \langle s \rangle \theta(l, w')  
\end{eqnarray*}


\NI The function $\mathsf{bang}(\cdot)$ on models is given by the following clauses.

\begin{eqnarray*}
\mathsf{bang}((\mathcal{W},\rightarrow,\lambda),w) & \ = \ & \top \mbox{ if } \lambda(w) = \mathcal{S}  \\
\mathsf{bang}((\mathcal{W},\rightarrow,\lambda),w) & \ = \ & ! \; \lambda(w) \mbox{ otherwise }  \\
\mathsf{trans}((\mathcal{W},\rightarrow, \lambda),w) & \ = \ & \{(s,w') | w \xrightarrow{s} w' \} 
\end{eqnarray*}

\NI Note that $\theta(m)$ is finite if $m$ contains no cycles and if
$\lambda(x)$ is either $\mathcal{S}$ or finite for all states $x$.
Note also that $\mu$ and $\theta$ are inverses of each other in that:

\[
   \mu(\theta(m)) \ = \  m  
      \qquad\qquad
   \theta(\mu(p)) \ \text{ iff } \ p 
\]

\NI We are now ready to prove completeness.  We will show that $p
\models q$ implies there is a derivation of $p \judge q$.  Our proof
will make use of two key facts:

\begin{lemma}\label{lemma:completeness:4}
If $m \models p$ then $\theta(m) \judge p$.
\end{lemma}

\begin{lemma}\label{lemma:completeness:5}
For all formulae $p$, we can derive $p \judge \theta(\mu(p))$.
\end{lemma}

\martin{Add short explanation of Lemma \ref{lemma:completeness:4}}.

As to Lemma \ref{lemma:completeness:5}, $\mu(p)$ is the simplest model
satisfying $p$, and $\theta(m)$ is the simplest formula describing
$m$, so $\theta(\mu(p))$ is a simplified form of $p$. This lemma
states that EL has the inferential capacity to transform any
proposition into its simplified form.

With these two lemmas in hand, the proof of completeness is
straightforward.  Assume $p \models q$.  Then all models which satisfy
$p$ also satisfy $q$.  In particular, $\mu(p) \models q$.  Then
$\theta(\mu(p)) \judge q$ by Lemma \ref{lemma:completeness:4}.  But we
also have, by Lemma \ref{lemma:completeness:5}, $p \judge
\theta(\mu(p)) $.  So by transitivity, we have $p \judge q$.  \qed


\subsection{The standard translation from  EL into FOL}\label{standardTranslation}

We now present a translation from EL to first-order logic. We have two
key purposes in mind:

\begin{itemize}

\item To facilitate the comparison between EL and conventional
  first-order logic, to pin down precisely where EL and first-order
  logic differ and where they don't.

\item To enable technology transfer between EL and other logics. We
  are inspired here in particular by the standard translation of modal
  logic into first-order logic \cite{BlackburnP:modlog} which has
  allows the transfer of interesting results such as compactness to
  modal logic, but has also given rise to many interesting concepts in
  first-order logic.  Historically, fragments of first-order logic
  that were studied were defined by quantifier hierarchies. Modal
  logics picks out very different fragments. For example fragments
  closed under bisimulation, guarded fragments, fragments with
  restricted numbers of variables.

\end{itemize}

\input{figure:embedding}

\NI We will translate EL into a restricted fragment of FOL \martin{one-sorted FOL?} (cf.~Figure
\ref{figure:embedding}). The translation makes use of three types of
predicate:

\begin{itemize}

\item A 0-place predicate $\top$, which is true in all models.

\item A set of two-place predicates $Arr_s(x, y)$, one for each $s \in
  \mathcal{S}$, where $x$ and $y$ are of type $State$. $Arr_s(x, y)$
  is true if $x \xrightarrow{s} y$.

\item A set of one-place predicates $Restrict_A$, one for each finite
  subset $A \subseteq \mathcal{S}$.  $Restrict_{A}(x)$ is true if
  $\lambda(x) = A$.

\end{itemize}

\NI Choose two fixed variables $x_1, x_2$, let $s$ range over symbols
in $\mathcal{S}$, and $A$ over \martin{finite?} subsets of
$\mathcal{S}$. Then the restricted fragment of FOL that is the target
of our translation is given by the followign grammar.

\begin{GRAMMAR}
  \phi 
     &\quad ::= \quad&
  \top \fOr Arr_{s}(x_1, x_2)\fOr Restrict_A(x_1) \fOr \phi_1 \AND \phi_2 \fOr \exists x_1 . \phi 
\end{GRAMMAR}

\NI Notice that this fragment of FOL has no negation, disjunction,
implication, or universal quantification. Notice also that two
variables suffice.

The translation of an EL formula is relative to a variable $x$ (which
will be instantiated to the particular state at which we are
evaluating the formula):

\begin{eqnarray*}
  T_x(\top) & \ = \ & \top  \\
  T_x(\phi_1 \AND \phi_2) & \ = \ & T_x(\phi_1) \AND T_x(\phi_2)  \\
  T_x(\langle s \rangle \phi) & \ = \ & \exists y \; . \; Arr_s(x,y) \AND T_y(\phi)  \\
  T_x(\fBang A) & \ = \ & Restrict_A(x) 
\end{eqnarray*}

\NI So, for example:
\[
T_x(\langle a \rangle \top \AND \fBang \{a\}) = \exists y \; . \; Arr_a(x,y) \AND \top \AND Restrict_{\{a\}}(x)
\]


\subsection{Compactness}

First-order logic has compactness: a set $S$ of sentences has a model
exactly when every finite subset of $S$ does \cite[Chapter
  4.3]{EndertonHB:matinttl}. We now establish compactness for EL. Our
proof uses the standard translation into first-order logic, following
ideas from modal logic.

\martin{What follows below is from a really old draft and totally inconsistent with the rest of the text.
Need to make consistent!!}

\newcommand{\SEMB}[1]{\lbrack\!\lbrack #1 \rbrack\!\rbrack}
\newcommand{\STATE}{\mathsf{State}}
\newcommand{\SYMBOL}{\mathsf{Symbol}}
\newcommand{\DEFEQ}{\stackrel{\text{\emph{def}}}{=}}
\newcommand{\TRUTH}{\LOGIC{T}}
\newcommand{\TRUE}{\LOGIC{t}}
\newcommand{\LOGIC}[1]{\mathsf{#1}}
\newcommand{\MMM}{\frak{M}}
\newcommand{\SSS}{\CAL{S}}
\newcommand{\IMPLIES}{\supset}
\newcommand{\RED}{\rightarrow}
\newcommand{\RESTRICT}[2]{\mathsf{Restrict}_{#1}(#2)}
\newcommand{\ARROW}[2]{\mathsf{Arrow}(#1, #2)}

\NI Clearly each eremic model $\MMM = (V, \RED)$ gives rise to a
first-order model as follows.

\begin{itemize}

\item The universe for $\SYMBOL$ is $\SSS$.

\item The universe for $\STATE$ is $V$.

\item The relation $R$ is given by $\RED$.

\item The constants $c_{\alpha}$ are given by $\alpha$.

\item The two forms of equality are given by the respective
  set-theoretic equalites.

\end{itemize}

\NI We denote this model by $\SEMB{\MMM}$. The correctness of the
standard translation is given by the following theorem.

\begin{theorem}[Local and global correspondence theorem]\label{correspondence:theorem}
Let $A$ be an eremic formula.
\begin{enumerate}

\item For all eremic models $\MMM$ and states $s$: $\MMM \models_s A$
  iff $\SEMB{\MMM} \models_{x \mapsto s} \SEMB{A}_x$.

\item For all eremic models $\MMM$: $\MMM \models A$ iff $\SEMB{\MMM}
  \models \forall x.\SEMB{A}_x$.

\end{enumerate}
\end{theorem}
\begin{proof}
By induction on the structure of $A$.
\end{proof}


Clearly we can also start out with a model $\MMM$ of the FOL language,
and convert it to an eremic model $\MMM^{\sharp} = (V, \RED)$ as
follows.

\begin{itemize}

\item The states $V$ are given by the $\MMM$ interpretation of states.

\item The reduction relation $s \TRANS{\alpha} t$ holds exactly when
  $R^{\MMM}$, the interpretation of $R$ in $\MMM$ satisfies
  $R^{\MMM}(s, c^{\MMM}_{\alpha}, t)$. Here $c^{\MMM}_{\alpha}$ is the
  $\MMM$ interpretation of $c_{\alpha}$.

\end{itemize}

\begin{lemma}\label{modelIso:lemma}
For all $\LLL$ models $\MMM$: $\SEMB{\MMM^{\sharp}} = \MMM$.
Likewise, for all eremic models $\MMM$: 
 $\SEMB{\MMM}^{\sharp} = \MMM$.
\end{lemma}
\begin{proof}
To do\footnote{I have not actually proved this, maybe the statement of
  the theorem needs to be weakened a bit like so: $\MMM \models_{x
    \mapsto s} \SEMB{A}_x$ iff $\MMM^{\sharp} \models_s A$}.
\end{proof}

\begin{theorem}[Local and global correspondence theorem]
Let $A$ be an eremic formula.
\begin{enumerate}

\item For all eremic models $\MMM$ and states $s$: $\MMM \models_s A$
  iff $\SEMB{\MMM} \models_{x \mapsto s} \SEMB{A}_x$.

\item For all eremic models $\MMM$: $\MMM \models A$ iff $\SEMB{\MMM}
  \models \forall x.\SEMB{A}_x$.

\end{enumerate}
\end{theorem}
\begin{proof}
By induction on the structure of $A$.
\end{proof}



\begin{theorem}[Compactness of propositional eremic logic]
A set $T$ of eremic formulae is satisfiable iff each finite subset of
$T$ is satisfiable.
\end{theorem}
\begin{proof}
Let $T$ be a set of eremic formulae.  For any finite subset $T'$ of
$T$, assume that $T'$ is satisfiable.  Hence an eremic model $\MMM$
with state $s$ exists such that
\[
   \MMM \models_s A
\]
for each $A \in T'$. By Theorem \ref{correspondence:theorem} we know that
\[
   \SEMB{\MMM} \models_{x \mapsto s} \SEMB{A}_x.
\]
By compactness of FOL (Theorem \ref{compactnessFOL:theorem}) we thus know
that the set
\[
   \{ \SEMB{A}_x\ |\ A \in T\}
\]
has a model, say $\MMM_{T}$. Hence for all $A \in T$:
\[
   \MMM_T \models_{x \mapsto s} \SEMB{A}_x
\]
Using Lemma \ref{modelIso:lemma}, we conclude that
\[
   \MMM_T^{\sharp} \models_s A
\]
and $T$ is satisfiable.
\end{proof}

