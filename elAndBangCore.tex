\section{Core eremic logic: the EL$[\AND, !]$ fragment}\label{coreEL}

In this section we introduce the syntax and semantics of eremic logic.
Then we establish key completeness of the the proof rules and prove a
the compactness theorem via a translation into first-order logic. We
focus on a small core of eremic logic, leaving extensions to later
section.

\subsection{Syntax}



\begin{definition} Let $\Sigma$ be a non-empty set of \emph{actions}.\martin{Sketch why we require $\Sigma$ to be non-empty.}
Actions are ranged over by $a, a', a_1, b, ...$, and $A$ ranges over
finite subsets of $\Sigma$. The \emph{formulae}, ranged over by $\phi,
\psi, \xi ...$, of the \emph{EL$[\AND, !]$-fragment} are given by the
following grammar.

\begin{GRAMMAR}
  \phi 
     &\quad ::= \quad & 
  \TRUE 
     \VERTICAL 
  \phi \AND \psi
     \VERTICAL 
  \MAY{a}{\phi}
     \VERTICAL 
  \fBang A 
\end{GRAMMAR}

\NI The $!$ operator is used to restrict the allowable transitions
coming out of a state.  Intuitively, $\fBang A$ means that the
\emph{only} transitions coming out of the current state are those
specified in $A$.

\martin{Add better explanation of $\fBang$, and some examples?}

\martin{Explain why $\Sigma$ must be non-empty, and why $A$ in $!A$
  must be finite. What goes wrong if we drop those assumptions? Why do
  we allow $\Sigma$ be infinite anyway?}

\end{definition}

\subsection{Semantics}

\NI We now give the semantics of EL$[\AND, !]$-formulae using
transition systems, as described in Section \ref{preliminaries}, but
augmented with labels on states.

\begin{definition}
An \emph{eremic transition system} is a triple $(S, \rightarrow,
\lambda)$, where $(S, \rightarrow)$ is a labelled transition system
over $\Sigma$, and $\lambda$ is a function from states to sets of
actions (not necessarily finite), subject to the following constraints:
\begin{itemize}

\item For all states $s \in S$ it is the case that $ \{a \fOr \exists
  t \; s \xrightarrow{a} t\} \subseteq \lambda(s)$. We call this
  condition \emph{admissibility}.

\item For all states $s \in S$, $\lambda (s)$ is either finite or
  $\Sigma$. We call this condition \emph{well-sizedness}.

\end{itemize}

\end{definition}

\NI The intended interpretation is that $\lambda(w)$ is the set of
allowed transition symbols emanating from $w$.  The $\lambda$ function
is the semantic counterpart of the $!$ operator. 

\martin{motivate well-sizedness!}

\begin{definition}
A \emph{model}, ranged over by $\MMM, \MMM', ...$, is a pair $(\LLL,
s)$, where $\LLL$ is an eremic transition system $(S, \rightarrow,
\lambda)$, and $s$ is a state from $S$.
\end{definition}\martin{maybe we should call it eremic model to distinguish it from FOL models}

\input{figure:elAndBang:models}

\begin{definition}
The \emph{satisfaction relation} $\MMM \models \phi$ is defined
inductively by the following clauses, where we assume that $\MMM =
(\LLL, s)$ and $\LLL = (S, \rightarrow, \lambda)$.

\[
\begin{array}{lclcl}
  \MMM & \models & \top   \\
  \MMM & \models & \phi \AND \psi &\ \mbox{ iff } \ & \MMM  \models \phi \mbox { and } \MMM \models \psi  \\
  \MMM & \models & \langle a \rangle \phi & \mbox{ iff } & \text{there is a } s \xrightarrow{a} t \mbox { such that } (\LLL, t) \models \phi  \\
  \MMM & \models & \fBang A &\mbox{ iff } & \lambda(s) \subseteq A
\end{array}
\]

\end{definition}

\NI Figure \ref{figure:elAndBang:models} gives examples of models for
the formula $\MAY{a}{\MAY{b}{\TRUE}}$. \martin{Add more examples/discussion.}

\subsection{Inference Rules}

\input{figure:elAndBangRules}

\NI We now present the inference rules for eremic logic. 

\begin{definition} Judgements are of the following form.
\[
  \phi \judge \psi.
\]
Figure \ref{figure:elAndBangRules} presents all proof rules. There are
no axioms.
\end{definition}

\NI Note that $\phi$ and $\psi$ are single formulae, not sequents.  By
using single formalae, we can avoid structural inference rules.  EL
proof rules can be grouped in two parts: standard rules and rules
unique to EL.  Standard rules are [\RULENAME{Identity}],
[\RULENAME{$\top$-Right}], [\RULENAME{$\bot$-Left}],
[\RULENAME{Transitivity}], [\RULENAME{$\AND$-Left 1}],
[\RULENAME{$\AND$-Left 2}] and [\RULENAME{$\AND$-Right}] hardly need
explanation as they are variants of familiar rules for propositional
logic, see e.g.~\cite{TroelstraAS:basprot,vanDalenD:logstr}.  We now
explain the rules that give EL's its distinctive properties: the
relations betwen $\langle \rangle$, $!$ and $\bot$.

The rule [\RULENAME{$\bot$-Right 1}] axiom captures the core
\emph{exclusion} property of !: for example if $A = \{male, female\}$
then $\MAY{orange}{\phi}$ is incompatible with $!A$. Thus $!A \AND
\MAY{orange}{\phi}$ must be false.

The rule [\RULENAME{$\bot$-Right 2}] expresses that falsity is 'global'
  and cannot be surpressed by prefixing. For example
  $\MAY{orange}{\bot}$ is false, simply because $\bot$ is already
  false.

Relatedly, the rule [\RULENAME{Transition Normal}] enables us to
prefix an inference with a may-modality. For example \martin{add good
  example here.}. Note that it is vital for soundness that $\phi$ in $\phi
\judge \psi$ is a single formula. If we used transitional sequents $\phi_1, ..., \phi_n \judge \psi$,
then the rule
\[
   \ONEPREMISERULE
   {
     \phi_1, ..., \phi_n \judge \psi
   }
   {
     \MAY{a}{\phi_1}, ..., \MAY{a}{\phi_n} \judge \MAY{a}{\psi}
   }
\]
is unsound. \martin{explain why, and why this is significant}. This
restriction is also in place in \cite{GaySJ:typcalosp} where a
Curry-Howard corrospondence between a fragment of linear logic
\cite{GirardJY:linlog,GirardJY:protyp} and a process calculus is
introduced. We discuss the relationship between EL and linear logic in
general, and linear logic's additive conjunction in Section
\ref{conclusion}.


The three rules [\RULENAME{!-Left}, \RULENAME{!-Right 1},
  \RULENAME{!-Right 2}] jointly express of the subset relation
$\subseteq$ on sets of symbols relates to provability. Readers
familiar with object-oriented programming will recognise
[\RULENAME{!-Left}] as contra-variant subtyping and [\RULENAME{!-Right
    1}] as covariant subtyping. Honda \cite{HondaK:thetypftpc}
develops a full theory of subtyping based on similar ideas.  All three
rules embody the intuition that whenever $A \subseteq A'$ then
asserting that $!A'$ is as strong as, or a stronger statement than
$!A$. [\RULENAME{!-Left}] simply states that we can always strengthen
our premise, while [\RULENAME{!-right 1}] allows us to weaken the
premise. \martin{add an intuitive explanation for [\RULENAME{!-right 2}]!}!

Note that the logic has no axioms. One reason for a purely rule-based
presentation is the absence of implication in the present fragment of
EL. \martin{explain in more detail!}

We close this subsection with a key meta-theorem.

\begin{theorem}\label{theorem:elAndBang:soundComplete}
The rules in Figure \ref{figure:elAndBangRules} are sound and complete:
\begin{enumerate}

\item\label{theorem:elAndBang:sound} (Soundness) $\phi \judge \psi$ implies $\phi \models \psi$.

\item\label{theorem:elAndBang:complete} (Completeness) $\phi \models \psi$ implies $\phi \judge \psi$.

\end{enumerate}
\end{theorem}

\NI Soundness is immediate from the definitions. Proof of completeness is
deferred to Section \ref{completenessProof}. 

\begin{definition}
Let $\Gamma$ be an arbitrary set of formulae. We say \emph{$\Gamma$
  semantically implies $\phi$}, written $\Gamma \models \phi$,
provided for all eremic models $\MMM$ if it is the case that $\MMM
\models \Gamma$ implies $\MMM \models \phi$. We write $\phi_1, ...,
\phi_n \judge \psi$ whenever $\BIGAND_{i}\phi_i \judge \psi$.  For
arbitrary sets $\Gamma$ of formulae, we write $\Gamma \judge \psi$
provided there are $\phi_1, ..., \phi_n \in \Gamma$ such that $\phi_1,
..., \phi_n \judge \psi$.
\end{definition}

\martin{TO DO: show completeness in the sense of $\Gamma \models
  \phi$, then also $\Gamma \judge \phi$.}

\subsection{Example inferences}

We give some example inferences that illustrate how EL is used in
practise.
\martin{Add some example assertions here, for example some of those we
  use later.}

\subsection{Proof of completeness}\label{completenessProof}

\NI We now prove completeness of the rules in Figure
\ref{figure:elAndBangRules}.  The proof requires the development of
the following additional technology which is also useful in other
contexts.

\begin{itemize}

\item An ordering $\MODELLEQ$ on models, which enables us to speak of
  the simplest model satisfying a formula.

\item An algorithm which gives the simplest model for a formula.

\item An algorithm which gives the a formula characterising a model.

\end{itemize}

\NI We now develop these three in turn and then prove completeness.

\subsubsection{A partial ordering on models}

We shall define a partial-ordering $\MODELLEQ$ on models by extending
the notion of simulation on labeled transition systems. We then give
an alternative characterisation of $\MODELLEQ$ in terms of
set-inclusion of the theories induced by models.

\begin{definition}
Let $\LLL_i = (S_i, \rightarrow_i, \lambda_i)$ be eremic transition
systems for $i = 1, 2$.  A relation $\RRR \subseteq S_1 \times S_2$ is
a \emph{simulation from $\LLL_1$ to $\LLL_2$}, provided:
\begin{itemize} 

\item $\RRR$ is a simulation on the underlying transition systems. 

\item Whenever $(s, t) \in \RRR$ then also $\lambda_1(s) \supseteq
  \lambda_2(t)$.

\end{itemize}

\NI If $\MMM_i = (\LLL_i, s_i)$ are models, we say $\RRR$ is a
\emph{simulation from $\MMM_1$ to $\MMM_2$}, provided the following hold.

\begin{itemize}

\item $\RRR$ is a simulation from $\LLL_1$ to $\LLL_2$ as eremic transition systems.

\item  $(s_1, s_2) \in \RRR$. 

\end{itemize}
\end{definition}

\begin{definition}
The largest simulation from $\MMM_1$ to $\MMM_2$ is denoted $\MMM_1
\MODELLEQ \MMM_2$.  It is easy to see that $\MODELLEQ$ is itself a
simulation from $\MMM_1$ to $\MMM_2$, and the union of all such
simulations.  If $\MMM_1 \MODELLEQ \MMM_2$ we say $\MMM_2$
\emph{simulates} $\MMM_1$.
\end{definition}

\NI We give an alternative characterisation on $\MODELLEQ$ in terms of
theories of models.

\begin{definition}
Let $\THEORY{\MMM}$ be the formulae made true by $\MMM$,
i.e.~$\THEORY{\MMM} = \{\phi\ |\ \MMM \models \phi \}$.
\end{definition}

\begin{theorem}\label{theorem:completeLattice}
$\MMM' \MODELLEQ \MMM$ if and only if
$\THEORY{\MMM} \subseteq  \THEORY{\MMM'}$.
\end{theorem}

\begin{proof}
Assume $\MMM' \MODELLEQ \MMM$ and $\MMM \models \phi$.  We must show
$\MMM' \models \phi$.  Let $\MMM = (\LLL, w)$ and $\MMM' = (\LLL',
w')$.  The proof proceeds by induction on $\phi$.  The cases for
$\top$ and $\land$ are trivial.  Assume $\phi = \MAY{a}\psi$ and
assume $(\LLL, w) \models \MAY{a}\psi$.  Then $w \xrightarrow{a} x$
and $(\LLL, x) \models \psi$.  As $\MMM'$ simulates $\MMM$, there is
an $x'$ such that $(x,x') \in R$ and $w' \xrightarrow{a} x'$.  By the
induction hypothesis, $(\LLL', x') \models \psi$.  Therefore, by the
semantic clause for $!$, $(\LLL', w') \models \MAY{a}\psi$.  Assume
now that $\phi = \; ! \; A$, for some finite $A \subseteq \Sigma$, and
that $(\LLL, w) \models \; ! \; A$.  By the semantic clause for $!$,
$\lambda(w) \subseteq A$.  Since $(\LLL', w') \MODELLEQ (\LLL, w)$, by
the definition of simulation of eremic transition systems, $\lambda(w)
\supseteq \lambda'(w')$.  Therefore, $\lambda'(w') \subseteq
\lambda(w) \subseteq A$.  Therefore, by the semantic clause for $!$,
$(\LLL', w') \models \; ! \; A$.

For the other direction, let $\MMM = (\LLL, w)$ and $\MMM' = (\LLL',
w')$.  Assume $\THEORY{\MMM} \subseteq \THEORY{\MMM'} $. We need to
show that $\MMM'$ simulates $\MMM$.  In other words, we need to
produce a relation $R \subseteq S \times S'$ where $S$ is the state
set of $\LLL$, $S'$ is the state set for $\LLL'$ and $(w,w') \in R$
and $R$ is a simulation from $(\LLL, w)$ to $ (\LLL', w')$.  Define $R
= \{(x,x') \; | \; \THEORY{ (\LLL, x)} \subseteq \THEORY{ (\LLL',
  x')}\}$.  Clearly, $(w,w') \in R$, as $\THEORY{(\LLL, w)} \subseteq
\THEORY{(\LLL', w')} $.  To show that $R$ is a simulation, assume $x
\xrightarrow{a} y$ in $\LLL$ and $(x,x') \in R$. We need to provide a
$y'$ such that $x' \xrightarrow{a} y'$ in $\LLL'$.  Consider the
formula $\MAY{a}\top$. Now $(\LLL, x) \models \MAY{a}\top$ because $x
\xrightarrow{a} y$.  But as $(x,x') \in R$, $\THEORY{(\LLL, x)}
\subseteq \THEORY{(\LLL', x')} $, so $(\LLL', x') \models
\MAY{a}\top$.  But, by the semantic clause for $\MAY{a}$, this means
there is a $y'$ such that $x' \xrightarrow{a} y'$ in $\LLL'$, Finally,
we need to show that whenever $(x,x') \in R$, then $\lambda(x)
\supseteq \lambda'(x')$.  Assume, first, that $\lambda(x)$ is finite.
Then $(\LLL, x) \models \; ! \; \lambda(x)$.  But as $(x,x') \in R$,
$\THEORY{(\LLL, x)} \subseteq \THEORY{(\LLL', x')} $, so $(\LLL', x')
\models \; ! \; \lambda(x)$.  But, by the semantic clause for $!$,
$(\LLL', x') \models \; ! \; \lambda(x)$ iff $\lambda'(x') \subseteq
\lambda(x)$.  Therefore $\lambda(x) \supseteq \lambda'(x')$.  If, on
the other hand, $\lambda(x)$ is infinite, then $\lambda(x) = \Sigma$
(because the only infinite node labelling that we allow is
$\Sigma$). Every node labelling is a subset of $\Sigma$, so here too,
$\lambda(x) = \Sigma \supseteq \lambda'(x')$.  \qed
\end{proof}

\NI Theorem \ref{theorem:completeLattice} illustrates from a
model-theoretic point of view how classical and eremic logic
differ. In classical logic the theory of each model is complete, and
$\THEORY{\CAL{M}} \subseteq \THEORY{\CAL{N}}$ already implies that
$\THEORY{\CAL{M}} = \THEORY{\CAL{N}}$, i.e.~$\CAL{M}$ and $\CAL{N}$
are elementarily equivalent. Eremic logic's lack of negation changes
this drastically, and gives $\MODELLEQ$ the structure of a non-trivial
complete lattice as we shall demonstrate now.

It turns out that $\MODELLEQ $ on (equivalence classes of) models is
not just a partial order, but almost a complete lattice, except that a
bottom element is missing.

\begin{definition}
We extend the collection of models with a single \emph{bottom} element
$\bot$, where $\bot \models \phi$ for all $\phi$. 
We extend the relation $\MODELLEQ $  and stipulate that $\bot
\MODELLEQ \MMM$ for all models $\MMM$.
\end{definition}



\begin{theorem}
The collection of models together with $\bot$, and ordered by $\MODELLEQ $
is a complete lattice.  \martin{strictly speaking this is NOT true, because we
  can simply rename states and get new models that break
  e.g. anti-symmetry. I guess we need to quotient somehow, e.g.  $(
  (\{w\}, \{\}, \{w \mapsto \Sigma\}), w)$ and $( (\{v\}, \{\},
  \{v \mapsto \Sigma\}), v)$ need to be equated.}
\end{theorem}
\begin{proof}
\martin{worth doing?}  Example: The topmost element in the lattice is
the model $( (\{w\}, \{\}, \{w \mapsto \Sigma\}), w)$ (for some state
$w$): this is the model with no transitions and no transition
restrictions.\martin{I think this is not well-defined if $\Sigma$ is
  infinite. Remember that the labelling function $\lambda$ now always
  must map to finite sets of actions.}
\end{proof}

\subsubsection{Computing the simplest model satisfying a formula}

\NI In $\MODELLEQ $ we have a notion of model simplicity.  We can now
compute $\SIMPL{\phi}$, the simplest model w.r.t.~$\MODELLEQ $ that
satisfies $\phi$.

\begin{eqnarray*}
  \SIMPL{\top} &\ = \ & ( (\{v\}, \{\}, \{v \mapsto \Sigma\}), v)  \\
  \SIMPL{\fBang A} & = & ( (\{v\}, \{\}, \{v \mapsto A\}), v)  \\
  \SIMPL{\phi_1 \AND \phi_2} & = & \SIMPL{\phi_1} \sqcap \SIMPL{\phi_2}  \\
  \SIMPL{\langle a \rangle \phi} 
     & = & ( (S \cup \{w'\}, \rightarrow \cup (w' \xrightarrow{a} w), \lambda \cup \{w' \mapsto \Sigma\}]), w')  \\
		& & \mbox{where }\SIMPL{\phi} = ( (S, \rightarrow, \lambda), w) \mbox{and } w' \mbox{ is a new state} \\
                &&  \mbox{not appearing in }S 
\end{eqnarray*}

\NI The only complex case is the clause for $\SIMPL{\phi_1 \AND \phi_2}$,
which uses the $\sqcap$ function, defined as follows, where we assume
that the sets of states in the two models are disjoint.

\begin{eqnarray*}
  \bot \sqcap \MMM  &\ =\ &  \bot  \\
  \MMM \sqcap \bot      & = &  \bot  
     \\
  \MMM \sqcap \MMM'
     & = & 
  \begin{cases}
    \mathsf{merge}(\MMM, \MMM') & \text{if}\ \mathsf{consistent}(\MMM, \MMM') \\
    \bot & \text{else}
  \end{cases}
\end{eqnarray*}

\NI The $\mathsf{consistent}$ predicate is true of models $m$ and $n$ if
the out-transitions on $m$'s root state respect the labelling on $n$'s
root state, and the out-transitions on $n$'s root state respect the
labelling on $m$'s root state. In other words:

\begin{eqnarray*}
  \mathsf{consistent}(\MMM, \MMM') 
     &\ \mbox{ iff }\ & 
  \begin{cases}
    \mathsf{out}(\MMM) \subseteq \mathsf{restriction}(\MMM') \mbox{ and}  \\
    \mathsf{out}(\MMM') \subseteq \mathsf{restriction}(\MMM) 
  \end{cases}
\end{eqnarray*}

\NI Here:

\[
\begin{array}{rcl}
  \mathsf{out}(((S,\rightarrow,\lambda),w)) 
     &\ =\ & \{ a \fOr \exists w' . w \xrightarrow{a} w'\}  \\
  \mathsf{restriction}(((S,\rightarrow,\lambda),w)) 
    & = & 
  \lambda(w) 
\end{array}
\]

\NI Now the $\mathsf{merge}$ function fuses two  models together:
\[
   \mathsf{merge}( ( (S, \rightarrow, \lambda), w),  ( (S', \rightarrow', \lambda'), w')) 
      \ =\ 
   ((S \cup S', \rightarrow \cup \rightarrow'_2, \lambda_2 \cup \lambda'_2), w)
\]
where:
\begin{eqnarray*}
  \rightarrow'_2 &\ =\ & \rightarrow' \mbox{ with } w' \mbox{ replaced by } w  \\
  \lambda_2 & = & \lambda \mbox{ with } w \mapsto \lambda(w) \cap \lambda'(w')  \\
  \lambda'_2 & = & \lambda' \mbox{ with } w' \mbox{ removed } 
\end{eqnarray*}

\NI It is easy to show that $\SIMPL{\cdot}$ has the following properties:

\begin{itemize}

\item $\SIMPL{\phi} \models \phi$.

\item If $\MMM' \models \phi$ and  $\MMM \MODELLEQ \MMM'$ then also  $\MMM \models \phi$.
 
\end{itemize}

\subsubsection{Characteristic formulae}

The function $\SIMPL{\cdot}$ goes form formulae to models. Now we go
the other way: given a model $\MMM$, we compute its characteristic
formula $\CHAR{m}$. The formula $\SIMPL{\MMM}$ characterises the model
$\MMM$ in the following sense. \martin{Check that they are
  true. Proofs?}

\begin{itemize}

\item  $\MMM \models \phi$ implies $\CHAR{\MMM} \models \phi$.

\item  $\MMM \models \CHAR{ \MMM' }$ exactly when $\MMM \MODELLEQ \MMM'$.

\item $\MMM = \BIGLUB \{\MMM' \ |\ \MMM' \models \CHAR{\MMM} \}$.

\end{itemize}

\martin{we must define $\BIGLUB$!}

\NI This notion of characteristic formula is closely related to
characteristic formulae in Hennessy-Milner logic
\cite{AcetoL:chaforfata} and Hoare logics
\cite{HondaK:descriptive,ChargueraudA:provertcf}. Here is the
definition of $\CHAR{\cdot}$.

\begin{eqnarray*}
  \CHAR{\bot} &\ =\ & \langle a \rangle \top \AND ! \emptyset  \mbox{ for some symbol }a  \\
  \CHAR{\MMM, w} & = & \mathsf{bang}(\MMM,w) \AND \bigwedge_{(a,w') \in \mathsf{trans}(l,w)} \langle a \rangle \CHAR{\MMM, w'}  
\end{eqnarray*}

\martin{Note that in its current form $\CHAR{\bot}$ defines a
  relation, not a function, because $a$ an vary.}

\NI The functions $\mathsf{bang}(\cdot)$ and $\mathsf{trans}$ on
models are given by the following clauses.

\begin{eqnarray*}
  \mathsf{bang}((S,\rightarrow,\lambda),w) 
     & \ = \ & 
  \begin{cases}
    \top & \mbox{ if } \lambda(w) = \Sigma  \\
    ! \; \lambda(w) & \mbox{ otherwise }  
  \end{cases} \\
  \mathsf{trans}((S,\rightarrow, \lambda),w) & \ = \ & \{(a,w') | w \xrightarrow{a} w' \} 
\end{eqnarray*}

\NI Note that $\CHAR{\MMM}$ is finite if $\MMM$ contains no cycles and if
$\lambda(x)$ is either $\Sigma$ or finite for all states $x$.
Note also that $\SIMPL{\cdot}$ and $\CHAR{\cdot}$ are inverses of each other in that:

\begin{itemize}

\item $\SIMPL{\CHAR{\MMM}} \ = \  \MMM$. \martin{Is this set-theoretic equality?}

\item $\CHAR{\SIMPL{\phi}}$ iff $\phi$.\martin{is this $\vdash$ or $\models$?}

\end{itemize}

\NI We are now ready to prove completeness.  We will show that $\phi
\models \psi$ implies there is a derivation of $\phi \judge \psi$.  Our proof
will make use of two key facts:

\begin{lemma}\label{lemma:completeness:4}
If $m \models \phi$ then $\CHAR{\MMM} \judge \phi$.
\end{lemma}

\begin{lemma}\label{lemma:completeness:5}
For all formulae $\phi$, we can derive $\phi \judge \CHAR{\SIMPL{\phi}}$.
\end{lemma}

\martin{Add short explanation of Lemma \ref{lemma:completeness:4}}.

As to Lemma \ref{lemma:completeness:5}, $\SIMPL{\phi}$ is the simplest model
satisfying $\phi$, and $\CHAR{\MMM}$ is the simplest formula describing
$m$, so $\CHAR{\SIMPL{\phi}}$ is a simplified form of $\phi$. This lemma
states that EL has the inferential capacity to transform any
proposition into its simplified form.

With these two lemmas in hand, the proof of completeness is
straightforward.  Assume $\phi \models \psi$.  Then all models which satisfy
$\phi$ also satisfy $\psi$.  In particular, $\SIMPL{\phi} \models \psi$.  Then
$\CHAR{\SIMPL{\phi}} \judge \psi$ by Lemma \ref{lemma:completeness:4}.  But we
also have, by Lemma \ref{lemma:completeness:5}, $\phi \judge
\CHAR{\SIMPL{\phi}} $.  So by transitivity, we have $\phi \judge \psi$.  \qed


\subsection{The standard translation from  eremic logic into 
            first-order logic}\label{standardTranslation}

We now present a translation from EL to first-order logic. We have two
key purposes in mind:

\begin{itemize}

\item To facilitate the comparison between EL and conventional
  first-order logic, to pin down precisely where EL and first-order
  logic differ and where they don't.

\item To enable technology transfer between EL and other logics. We
  are inspired here in particular by the standard translation of modal
  logic into first-order logic \cite{BlackburnP:modlog} which has
  allows the transfer of interesting results such as compactness to
  modal logic, but has also given rise to many interesting concepts in
  first-order logic.  Historically, fragments of first-order logic
  that were studied were defined by quantifier hierarchies. Modal
  logics picks out very different fragments. For example fragments
  closed under bisimulation, guarded fragments, fragments with
  restricted numbers of variables.

\end{itemize}

\input{figure:embedding}

\NI We will translate EL into a restricted fragment of first-order
logic (cf.~Figure \ref{figure:embedding}). The first-order signature
$\SSS$ has a nullary predicate $\top$, a family of unary predicates
$\RESTRICT{A}{\cdot}$, one for each finite subset $A \subseteq
\Sigma$, and a family of binary predicates $\ARROW{a}{x}{y}$, one for
each action $a \in \Sigma$.  The intended interpretation is as
follows.

\begin{itemize}

\item The universe is composed of states.

\item The predicate $\top$, which is true everywhere.

\item For each finite $A \subseteq \Sigma$ and each state $s$,  $\RESTRICT{A}{s}$
is true if 
  $\lambda(x) \subseteq A$.

\item A set of two-place predicates $\ARROW{a}{x}{y}$, one for each $a
  \in \Sigma$, where $x$ and $y$ range over states. $\ARROW{a}{x}{y}$
  is true if $x \xrightarrow{a} y$.


\end{itemize}

\NI Choose two fixed variables $x, y$, let $a$ range over actions in
$\Sigma$, and $A$ over finite subsets of $\Sigma$. Then the restricted
fragment of FOL that is the target of our translation is given by the
following grammar, where $w, z$ range over $x, y$.

\begin{GRAMMAR}
  \phi 
     &\quad ::= \quad&
  \top \fOr \ARROW{a}{w}{z}\fOr \RESTRICT{A}{z} \fOr \phi \AND \psi \fOr \exists x. \phi 
\end{GRAMMAR}

\NI Notice that this fragment of FOL has no negation, disjunction,
implication, or universal quantification. 

The translations $\SEMB{\phi}_x$ and $\SEMB{\phi}_y$ of an EL formula
$\phi$ are given relative to a state, denoted by either $x$ or $y$.

\[
\begin{array}{rclcrcl}
  \SEMB{\top}_x & \ = \ & \top  
     &\quad& 
  \SEMB{\top}_y & \ = \ & \top 
     \\
  \SEMB{\phi \AND \psi}_x & = & \SEMB{\phi}_x \AND \SEMB{\psi}_x  
     && 
  \SEMB{\phi \AND \psi}_y & = & \SEMB{\phi}_y \AND \SEMB{\psi}_y  
     \\
  \SEMB{\langle a \rangle \phi}_x & = & \exists y.(\ARROW{a}{x}{y} \AND \SEMB{\phi}_y)  
     &&
  \SEMB{\langle a \rangle \phi}_y & = & \exists x.(\ARROW{a}{y}{x} \AND \SEMB{\phi}_x)  
     \\
  \SEMB{\fBang A}_x & = & \RESTRICT{A}{x}
     &&
  \SEMB{\fBang A}_y & = & \RESTRICT{A}{y}
\end{array}
\]

\NI The translations on the left and right are identical except for
switching $x$ and $y$. We continue with some example translations.

\[
   \SEMB{\langle a \rangle \top \AND \fBang \{a\}}_x 
      = 
   \exists y.(\ARROW{a}{x}{y} \AND \top ) \AND \RESTRICT{\{a\}}{x}
\]

\martin{Shall we discuss 1 or 2 more? Maybe one that illustrates the
variable switching?}

\NI We now establish the correctness of the encoding. The key issue
issue is that not every first-order model of our first-order signature
corresponds to an eremic model. The problem is that eremic models have
constraints that are not enforced by our signature, e.g.~$s \TRANS{a}
t$ implies that $a \in \lambda(s)$. Such models are 'junk' from the
point of view of eremic logic. 

We deal with this problem following ideas from modal logic
\cite{BlackburnP:modlog}: we add a translation $\SEMB{\LLL}$ for
eremic transition systems, and then prove the following theorem.

\begin{theorem}[correspondence theorem]\label{correspondence:theorem:1}
Let $\phi$ be an eremic formula and $\MMM = (\LLL, s)$ an eremic
model.
\[
   \MMM \models \phi \quad  \text{iff} \quad \SEMB{\LLL} \models_{x \mapsto s} \SEMB{\phi}_x.
\]
And likewise for $\SEMB{\phi}_y$.
\end{theorem}

\NI Before proving the theorem, we define $\SEMB{\LLL}$, which, given
an eremic transition system $\LLL$, produces a corresponding
first-order model for the signature $\SSS$ introduced above.

\begin{definition}
Let $\LLL = (S, \rightarrow, \lambda)$ be an eremic transition
system. Clearly $\LLL$ gives rise to an $\SSS$-model $\SEMB{\LLL}$ as
follows.
\begin{itemize}

\item The universe is the set $S$ of states.

\item The relation symbols are interpreted as follows.

  \begin{itemize}

    \item $\top^{\SEMB{\LLL}}$ always holds.

    \item $\mathsf{Restrict}_{A}^{\SEMB{\LLL}} = \{ s \in S\ |\ \lambda(s) \subseteq A\}$.

    \item $\mathsf{Arrow^{\SEMB{\LLL}}}_{a} = \{(s, t) \in S \times S\ |\ s \TRANS{a} t\}$.

  \end{itemize}
\end{itemize}
\end{definition}

\NI We are now ready to prove Theorem \ref{correspondence:theorem:1}.
\begin{proof}
By induction on the structure of $\phi$. The cases $\top$ and $\phi_1
\AND \phi_2$ are straightfoward.  The case $\MAY{a}\psi$ is handeled
as follows.
\begin{eqnarray*}
  \lefteqn{
  \SEMB{\LLL} \models_{x \mapsto s} \SEMB{\MAY{a}\psi}_x}\hspace{5mm} 
     \\
     &\quad \text{iff}\quad &
  \SEMB{\LLL} \models_{x \mapsto s} \exists y.(\ARROW{a}{x}{y} \AND \SEMB{\psi}_y) 
     \\
     &\text{iff}&
  \text{exists}\ t \in S. \SEMB{\LLL} \models_{x \mapsto s, y \mapsto t} \ARROW{a}{x}{y} \AND \SEMB{\psi}_y
     \\
     &\text{iff}&
  \text{exists}\ t \in S. \SEMB{\LLL} \models_{x \mapsto s, y \mapsto t} \ARROW{a}{x}{y} \ \text{and}\ \SEMB{\LLL} \models_{x \mapsto s, y \mapsto t}  \SEMB{\psi}_y
     \\
     &\text{iff}&
  \text{exists}\ t \in S. s \TRANS{a} t \ \text{and}\ \SEMB{\LLL} \models_{x \mapsto s, y \mapsto t}  \SEMB{\psi}_y
     \\
     &\text{iff}&
  \text{exists}\ t \in S. s \TRANS{a} t \ \text{and}\ \SEMB{\LLL} \models_{y \mapsto t}  \SEMB{\psi}_y \qquad (\text{as $x$ is not free in $\psi$})
     \\
     &\text{iff}&
  \text{exists}\ t \in S. s \TRANS{a} t \ \text{and}\ \MMM \models \psi
     \\
     &\text{iff}&
  \MMM \models \MAY{a}\psi  
\end{eqnarray*}

\NI Finally, if $\phi$ is $!A$ the derivation comes straight from the
definitions.
\begin{eqnarray*}
  \SEMB{\LLL} \models_{x \mapsto s} \SEMB{!A}_x
    &\quad \text{iff}\quad &
  \SEMB{\LLL} \models_{x \mapsto s} \RESTRICT{A}{x}
     \\
     &\text{iff}&
  \lambda(s) \subseteq A
     \\
     &\text{iff}&
  \MMM \models\ !A.
\end{eqnarray*}
\qed
\end{proof}

\input{compactness}
