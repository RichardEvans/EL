\section{Mathematical preliminaries}\label{preliminaries}

\NI This section briefly surveys the mathematical background of our
paper.  A fuller account of order-theory can be found in
\cite{DaveyBA:intlatao}.  Labelled transition systems are explored in
\cite{SassoneV:modcontac,HennessyM:Algtheop} and bisimulations in
\cite{SangiorgiD:intbisac}. Finally, \cite{EndertonHB:matinttl} is one
of many books on first-order logic.

\PARAGRAPH{Order-theory}
A \emph{preorder} is a pair $(S, \sqsubseteq)$ where $S$ is a set, and
$\sqsubseteq$ is a binary relation on $S$ that is reflexive and
transitive. Let $T \subseteq S$ and $x \in S$. We say $x$ is an
\emph{upper bound} of $T$ provided $t \sqsubseteq x$ for all $t \in
T$. If in addition $x \sqsubseteq y$ for all upper bounds $y$ of $T$,
we say that $x$ is the \emph{least} upper bound of $T$.  The set of
all least upper bounds of $T$ is denoted $\BIGLUB T$.  \emph{Lower
  bounds}, \emph{greatest lower bounds} and $\BIGGLB T$ are defined
mutatis mutandis.  A \emph{partial order} is a preorder $\sqsubseteq$
that is also anti-symmetric.  A partial order $(S, \sqsubseteq)$ is a
\emph{lattice} if every pair of elements in $S$ has a least upper and
a greatest lower bound.  A lattice is a \emph{bounded lattice} if it
has top and bottom elements $\top$ and $\bot$ such that for all $x \in
S$:
\[
x \sqcap \bot = \bot \nonumber \qquad
x \sqcup \bot = x \nonumber \qquad
x \sqcap \top = x \nonumber \qquad
x \sqcup \top = \top \nonumber.
\]

\NI If $(S, \sqsubseteq)$ is a preorder, we can turn it into a
partial-order by quotienting: let $a \simeq b$ iff $a \sqsubseteq b$
as well as $b \sqsubseteq a$. Clearly $\simeq$ is an equivalence. Let
$E$ be the set of all $\simeq$-equivalence classes of $S$. We get a
canonical partial order, denoted $\sqsubseteq_E$, on $E$ by setting:
$[a]_{\simeq} \sqsubseteq_E [b]_{\simeq}$ whenever $a \sqsubseteq
b$. If all relevant upper and lower bounds exist in $(S,
\sqsubseteq)$, then $(E, \sqsubseteq_E)$ becomes a bounded lattice by
setting
\[
   [x]_{\simeq} \sqcap [y]_{\simeq} = [ x \sqcap y ]_{\simeq}
       \quad
   [x]_{\simeq} \sqcup [y]_{\simeq} = [ x \sqcup y ]_{\simeq}
       \quad
   \bot_{E} = [\bot]_{\simeq}
       \quad
   \top_{E} = [\top]_{\simeq}.
\]


\PARAGRAPH{Transition systems}
Let $\Sigma$ be a set of \emph{actions}.  A \emph{labelled transition
  system over $\Sigma$} is a pair $(\mathcal{S}, \rightarrow)$ where
$\mathcal{S}$ is a set of \emph{states} and $\rightarrow \subseteq
\mathcal{S} \times \Sigma \times \mathcal{S}$ is the \emph{transition
  relation}.  We write $x \xrightarrow{a} y$ to abbreviate $(x,a,y)
\in \rightarrow$. We let $s, t, w, w', x, y, z, ...$ range over
states, $a, a', b, ...$ range over actions and $\LLL, \LLL', ...$
range over labelled transition systems. We usually speak of labelled
transition systems  when the set of actions is clear from the
context.  We say $\LLL$ is \emph{deterministic} if $x \TRANS{a} y$ and
$x \TRANS{a} z$ imply that $y = z$. Otherwise $\LLL$ is
\emph{non-deterministic}.  A labelled transition system is
\emph{finitely branching} if for each state $s$, the set $\{t\ |\ s
\TRANS{a} t\}$ is finite.

\PARAGRAPH{Simulations and bisimulations}
Given two labelled transition systems $\LLL_i = (S_i, \rightarrow_i)$
over $\Sigma$ for $i = 1, 2$, a \emph{simulation from $\LLL_1$ to
  $\LLL_2$} is a relation $\RRR \subseteq S_1 \times S_2$ such that
whenever $(s, s') \in \RRR$: if $s \TRANS{a}_1 s'$ then there exists a
transition $t \TRANS{a}_2 t'$ with $(t, t') \in \RRR$.  We write $s \SIM
t$ whenever $(s, t) \in \RRR$ for some simulation $\RRR$.  We say
$\RRR$ is a \emph{bisimulation between $\LLL_1$ and $\LLL_2$} if both,
$\RRR$ and $\RRR^{-1}$ are simulations. Here $\RRR^{-1} = \{(y,
x)\ |\ (x, y) \in \RRR\}$.  We say two states $s, s'$ are
\emph{bisimilar}, written $s \BISIM s'$ if there is a bisimulation
$\RRR$ with $(s, s') \in \RRR$.

\PARAGRAPH{First-order logic}
A \emph{many-sorted first-order signature} is specified by the
following data.  A non-empty set of \emph{sorts}, a set \emph{function
  symbols} with associated \emph{arities}, i.e.~non-empty list of
sorts $\#(f)$ for each function symbol $f$; a set of \emph{relation
  symbols} with associated \emph{arities}, i.e.~a list of sorts
$\#(R)$ for each relation symbol $R$; a set of \emph{constant symbols}
with associated \emph{arity}, i.e.~a sort $\#(c)$ for each constant
symbol $c$. We say a function symbol $f$ is \emph{$n$-ary} if $\#(f)$
has length $n+1$. Likewise, a relation symbol is \emph{$n$-ary} if
$\#(R)$ has length $n$.

Let $\SSS$ be a signature. An \emph{$\SSS$-model} $\CAL{M}$ is an
object with the following components.  For each sort $\sigma$ a set
$U_{\sigma}$ called \emph{universe} of sort $\sigma$.  The members of
$U_{\sigma}$ are called \emph{$\sigma$-elements} of $\CAL{M}$; an
element $c^\CAL{M}$ of $U_{\sigma}$ for each constant $c$ of sort
$\sigma$; a function $f^\CAL{M} : (U_{\sigma_1}\times \dots \times
U_{\sigma_n}) \rightarrow U_{\sigma}$ for each function symbol $f$ of
arity $(\sigma_1, ..., \sigma_n, \sigma)$; a relation $R^\CAL{M}
\subseteq U_{\sigma_1}\times \dots \times U_{\sigma_n}$ for each
relation symbol $R$ of arity $(\sigma_1, ..., \sigma_n)$.

Given an infinite set of variables for each sort $\sigma$, the
\emph{terms} and \emph{first-order formulae} for $\SSS$ are given by
the following grammar
\begin{GRAMMAR}
  t &\ ::=\ & x \VERTICAL c \VERTICAL f(t_1, ..., t_n) \\[1mm]
  \phi &::=& t = t' \VERTICAL R(t_1, ..., t_n) \VERTICAL \neg \phi \VERTICAL \phi \AND \psi \VERTICAL \forall x.A
\end{GRAMMAR}

\NI Here $x$ ranges over variables of all sorts, $c$ over constants,
$R$ over $n$-ary relational symbols and $f$ over $n$-ary function
symbols from $\SSS$.  Other logical constructs such as disjunction or
existential quantification are given by de Morgan duality, and truth
$\top$ is an abbreviation for $x = x$. If $\SSS$ has just a single
sort, we speak of \emph{single-sorted first-order logic} or just
\emph{first-order logic}. 

Given an $\SSS$-model $\CAL{M}$, an \emph{environment}, ranged over by
$\sigma$, is a partial function from variables to $\CAL{M}$'s
universes.  We write $x \mapsto u$ for the environment that maps $x$ to
$u$ and is undefined for all other variables. Moreover, if $\sigma, x
\mapsto u$ is the environment that is exactly like $\sigma$, except
that it also maps $x$ to $u$, assuming that $x$ is not in the domain
of $\sigma$.  The \emph{interpretation} $\SEMB{t}_{\CAL{M}, \sigma}$
of a term $t$ w.r.t. $\CAL{M}$ and $\sigma$ is given by the following
clauses, assuming that the domain of $\sigma$ contains all free
variables of $t$:
\begin{itemize}

\item $\SEMB{x}_{\CAL{M}, \sigma} = \sigma(x)$.
\item $\SEMB{c}_{\CAL{M}, \sigma} = c^{\CAL{M}}$.
\item $\SEMB{f(t_1, ..., t_n)}_{\CAL{M}, \sigma} =
  f^{\CAL{M}}(\SEMB{t_1}_{\CAL{M}, \sigma}, ..., \SEMB{t_n}_{\CAL{M},
    \sigma})$.

\end{itemize}

\NI The \emph{satisfaction relation} $\CAL{M} \models_{\sigma} \phi$
is given by the following clauses, this time assuming that the domain
of $\sigma$ contains all free variables of $\phi$:
\begin{itemize}

\item $\CAL{M} \models_{\sigma} t = t'$ iff $\SEMB{t}_{\CAL{M}, \sigma} = \SEMB{t'}_{\CAL{M}, \sigma}$.
\item $\CAL{M} \models_{\sigma} R(t_1, ..., t_n)$ iff
  $R^{\CAL{M}}(\SEMB{t_1}_{\CAL{M}, \sigma}, ..., \SEMB{t_n}_{\CAL{M},
  \sigma})$.
\item $\CAL{M} \models_{\sigma} \neg \phi$ iff $\CAL{M} \not\models_{\sigma} \phi$.
\item $\CAL{M} \models_{\sigma} \phi \AND \psi$ iff $\CAL{M} \models_{\sigma} \phi$ and $\CAL{M} \models_{\sigma} \psi$.
\item $\CAL{M} \models_{\sigma} \forall x.\phi$ iff for all $u$ in the
  universe of $\CAL{M}$ we have $\CAL{M} \models_{\sigma, x \mapsto v} \phi$.

\end{itemize}

\NI Note that if $\sigma$ and $\sigma'$ agree on the free variables of
$t$, then $\SEMB{t}_{\CAL{M}, \sigma} =\SEMB{t}_{\CAL{M},
  \sigma'}$. Likewise $\CAL{M} \models_{\sigma} \phi$ if and only iff
$\CAL{M} \models_{\sigma'} \phi$, provided $\sigma$ and $\sigma'$ agree
on the free variables of $\phi$.

The \emph{theory} of a model $\CAL{M}$, written $\THEORY{\CAL{M}}$, is
the set of all formulae made true by $\CAL{M}$, i.e.~$\THEORY{\CAL{M}}
= \{\phi\ |\ \CAL{M}\models \phi\}$. We say two models $\CAL{M}$ and
$\CAL{N}$ are \emph{elementary equivalent} if $\THEORY{\CAL{M}} =
\THEORY{\CAL{N}}$. In first-order logic $\THEORY{\CAL{M}} \subseteq
\THEORY{\CAL{N}}$ already implies that $\CAL{M}$ and $\CAL{N}$ are
elementary equivalent.
